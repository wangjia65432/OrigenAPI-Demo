<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.10"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>ORIGEN API: Solver/cram/tests/tstSolver_cram.cpp</title>
        <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="../../dynsections.js"></script>
        <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
        <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
        <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">ORIGEN API v0.5.2</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Overview</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../modules.html"><span>Components</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../d1/d5b/md__c_h_a_n_g_e_l_o_g.html"><span>Changelog</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Solver/cram/tests/tstSolver_cram.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**************************************************************************/</span> <span class="comment">/**</span></div>
<div class="line"><span class="comment">  * \file   tstSolver_cram.cpp</span></div>
<div class="line"><span class="comment">  * \brief  Unit tests for the class Solver_cram</span></div>
<div class="line"><span class="comment">  * \author Aarno Isotalo &amp; William Wieselquist</span></div>
<div class="line"><span class="comment">  *</span></div>
<div class="line"><span class="comment">  *****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;Nemesis/gtest/nemesis_gtest.hh&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Origen/Core/config.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../db/df0/_transition_matrix_p_8h.html">Origen/Core/dc/TransitionMatrixP.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d4/d11/_library_i_o_8h.html">Origen/Core/io/LibraryIO.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d10/_solver__cram_8h.html">Origen/Solver/cram/Solver_cram.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ScaleUtils/IO/DB.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// For Will&#39;s MultiZoneDepleter test</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d5/d77/print_8h.html">Origen/Core/fn/print.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d9/db6/_multi_zone_depleter_8h.html">Origen/Core/xf/MultiZoneDepleter.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d3/ddd/_fake_factory_8h.html">Origen/Core/dc/FakeFactory.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Standard/Interface/Communicator.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/**************************************************************************/</span> <span class="comment">/**</span></div>
<div class="line"><span class="comment">  * \brief  Test the check_opts() function.</span></div>
<div class="line"><span class="comment">  *****************************************************************************/</span></div>
<div class="line"><a name="a0"></a><a class="code" href="../../d1/d37/tst_alpha_spectra_8cpp.html#a7e1214809c1b242829640bc65dba3e55">TEST</a>( Solver_cram, check_opts )</div>
<div class="line">{</div>
<div class="line">    <a name="_a1"></a><a class="code" href="../../d4/d53/class_origen_1_1_solver__cram.html">Origen::Solver_cram</a> solver;</div>
<div class="line">    ScaleUtils::IO::DB opts;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get the default options</span></div>
<div class="line">    solver.<a name="a2"></a><a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;std::string&gt;( <span class="stringliteral">&quot;solver&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramOrder&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramInternalSubsteps&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;isAdjoint&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramRemoveNegatives&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;cramResultsCutoff&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyEnergyReleased&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumFissions&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumCaptures&quot;</span> ) );</div>
<div class="line">    EXPECT_TRUE( opts.has&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyAveConcentrations&quot;</span> ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check the default options</span></div>
<div class="line">    EXPECT_TRUE( solver.<a name="a3"></a><a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    EXPECT_TRUE( <a name="a4"></a><a class="code" href="../../d4/d53/class_origen_1_1_solver__cram.html#a44f5d6e4c2eb3f0613e0eff03ab1bcba">Origen::Solver_cram::check_opts_static</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// *** Test allowing missing arguments</span></div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramOrder&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramInternalSubsteps&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;isAdjoint&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramRemoveNegatives&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;cramResultsCutoff&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyEnergyReleased&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumFissions&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumCaptures&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyAveConcentrations&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts );</div>
<div class="line">    opts.remove&lt;std::string&gt;( <span class="stringliteral">&quot;solver&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">false</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// *** Test incorrect input</span></div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts, <span class="keyword">true</span> );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramInternalSubsteps&quot;</span>, -1 );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts, <span class="keyword">true</span> );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramOrder&quot;</span>, 13 );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line"></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a7dba0121a9adaba1a04aec64a5769011">get_defaults</a>( opts, <span class="keyword">true</span> );</div>
<div class="line">    opts.set&lt;std::string&gt;( <span class="stringliteral">&quot;solver&quot;</span>, <span class="stringliteral">&quot;matrex&quot;</span> );</div>
<div class="line">    EXPECT_FALSE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( opts, <span class="keyword">true</span> ) );</div>
<div class="line">    opts.clearErrorStack();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Print all errors for manual checking of their formatting (kills the test)</span></div>
<div class="line">    <span class="keywordflow">if</span>( <span class="keyword">false</span> )</div>
<div class="line">    {</div>
<div class="line">        ScaleUtils::IO::DB dummy;</div>
<div class="line">        solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( dummy, <span class="keyword">false</span> );</div>
<div class="line">        dummy.set&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramOrder&quot;</span>, 13 );</div>
<div class="line">        dummy.set&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramInternalSubsteps&quot;</span>, -1 );</div>
<div class="line">        dummy.set&lt;std::string&gt;( <span class="stringliteral">&quot;solver&quot;</span>, <span class="stringliteral">&quot;matrex&quot;</span> );</div>
<div class="line">        dummy.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;isAdjoint&quot;</span>, false );</div>
<div class="line">        dummy.set&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramRemoveNegatives&quot;</span>, 5 );</div>
<div class="line">        dummy.set&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;cramResultsCutoff&quot;</span>, -1.0 );</div>
<div class="line">        solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#ac35de52a38ca9b44757c1fd2d018afd8">check_opts</a>( dummy, <span class="keyword">false</span> );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/**************************************************************************/</span> <span class="comment">/**</span></div>
<div class="line"><span class="comment">  * \brief  Test the set_opts() function.</span></div>
<div class="line"><span class="comment">  *****************************************************************************/</span></div>
<div class="line"><a class="code" href="../../d1/d37/tst_alpha_spectra_8cpp.html#a7e1214809c1b242829640bc65dba3e55">TEST</a>( Solver_cram, set_opts )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="../../d4/d53/class_origen_1_1_solver__cram.html">Origen::Solver_cram</a> solver;</div>
<div class="line">    ScaleUtils::IO::DB opts;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set some options.</span></div>
<div class="line">    opts.set&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramOrder&quot;</span>, 14 );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramInternalSubsteps&quot;</span>, 5 );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;isAdjoint&quot;</span>, true );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramRemoveNegatives&quot;</span>, 0 );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;cramResultsCutoff&quot;</span>, 1e-50 );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyEnergyReleased&quot;</span>, true );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumFissions&quot;</span>, true );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumCaptures&quot;</span>, true );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyAveConcentrations&quot;</span>, true );</div>
<div class="line">    solver.<a name="a5"></a><a class="code" href="../../d2/df0/class_origen_1_1_solver.html#aae07a5e0a6d1d4ffa6b25feccbfb3e92">set_opts</a>( opts );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check that the options were correctly set.</span></div>
<div class="line">    ScaleUtils::IO::DB status = solver.<a name="a6"></a><a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a585cd31bba044ea2fead91ae062010c9">status</a>();</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramOrder&quot;</span> ), status.get&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramOrder&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramInternalSubsteps&quot;</span> ),</div>
<div class="line">               status.get&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramInternalSubsteps&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;isAdjoint&quot;</span> ), status.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;isAdjoint&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramRemoveNegatives&quot;</span> ),</div>
<div class="line">               status.get&lt;<span class="keywordtype">int</span>&gt;( <span class="stringliteral">&quot;cramRemoveNegatives&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;cramResultsCutoff&quot;</span> ),</div>
<div class="line">               status.get&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;cramResultsCutoff&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyEnergyReleased&quot;</span> ),</div>
<div class="line">               status.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyEnergyReleased&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumFissions&quot;</span> ),</div>
<div class="line">               status.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumFissions&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumCaptures&quot;</span> ),</div>
<div class="line">               status.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumCaptures&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( opts.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyAveConcentrations&quot;</span> ),</div>
<div class="line">               status.get&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyAveConcentrations&quot;</span> ) );</div>
<div class="line">    EXPECT_EQ( <span class="stringliteral">&quot;cram&quot;</span>, status.get&lt;std::string&gt;( <span class="stringliteral">&quot;solver&quot;</span> ) );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/**************************************************************************/</span> <span class="comment">/**</span></div>
<div class="line"><span class="comment">  * \brief  Test solving.</span></div>
<div class="line"><span class="comment">  *****************************************************************************/</span></div>
<div class="line"><a class="code" href="../../d1/d37/tst_alpha_spectra_8cpp.html#a7e1214809c1b242829640bc65dba3e55">TEST</a>( Solver_cram, solve )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="../../d4/d53/class_origen_1_1_solver__cram.html">Origen::Solver_cram</a> solver;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Load a library.</span></div>
<div class="line">    <a name="_a7"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a> lib;</div>
<div class="line">    ASSERT_TRUE( <a name="a8"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#aeeab0b5173c8f0f318815516c66f96d1">Origen::FakeFactory::Library_scale_pwr</a>( lib ) );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#afb55bc73ff1ba4f1605a68227ee92603">Origen::TransitionMatrixP::SP</a> trx = lib.<a name="a9"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html#a977b919cc2065a44e3a8adfbe680eb49">newsp_transition_matrix_at</a>( 0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Number of nuclides.</span></div>
<div class="line">    <span class="keywordtype">int</span> itot = trx-&gt;get_itot();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Step length.</span></div>
<div class="line">    <span class="keywordtype">double</span> dt = 100 * 60 * 60 * 24;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set the transition matrix.</span></div>
<div class="line">    solver.<a name="a10"></a><a class="code" href="../../d2/df0/class_origen_1_1_solver.html#abe37ab3d53f6b75bd47836c0f1cb6c8c">set_transition_matrix</a>( &amp;*trx );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set source term.</span></div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Origen::Vec_Dbl</a> src( itot, 0.0 );</div>
<div class="line">    src[trx-&gt;find_nuclide_guess( 922350 )] = 0.05e-7;</div>
<div class="line">    src[trx-&gt;find_nuclide_guess( 922380 )] = 0.20e-7;</div>
<div class="line">    src[trx-&gt;find_nuclide_guess( 932390 )] = 0.05e-7;</div>
<div class="line">    src[trx-&gt;find_nuclide( 1, 350790 )] = 1e-7;</div>
<div class="line">    src[trx-&gt;find_nuclide( 1, 350810 )] = 1e-20;</div>
<div class="line">    src[trx-&gt;find_nuclide( 1, 350780 )] = 1e-7;</div>
<div class="line">    src[trx-&gt;find_nuclide( 1, 350800 )] = 1e-20;</div>
<div class="line">    solver.<a name="a11"></a><a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a67f04d1925ad34f2df01bdf8625f81c2">set_source</a>( &amp;src );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initial composition.</span></div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Origen::Vec_Dbl</a> n0( itot, 0.0 );</div>
<div class="line">    n0[trx-&gt;find_nuclide_guess( 922350 )] = 0.05;</div>
<div class="line">    n0[trx-&gt;find_nuclide_guess( 922380 )] = 0.95;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Final composition.</span></div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Origen::Vec_Dbl</a> n( itot, 0.0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Solve.</span></div>
<div class="line">    EXPECT_TRUE( solver.<a name="a12"></a><a class="code" href="../../d2/df0/class_origen_1_1_solver.html#af4682463633952a2e3fd6477b3ed9318">solve</a>( n0, 3.5e14, dt, &amp;n ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check the results. Reference values were calculated with CRAM in</span></div>
<div class="line">    <span class="comment">// tstCRAM.FreshFuelDepletionWithSource</span></div>
<div class="line">    <span class="comment">// (Origen/Manager/Wrapper/tests/tstCRAM.cpp)</span></div>
<div class="line">    <span class="comment">// and extracted by adding the below lines. This only needs to test that</span></div>
<div class="line">    <span class="comment">// CRAM was called properly.</span></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">    printf(&quot;%.14e\n&quot;,n[trx-&gt;find_nuclide_guess(922350)]);</span></div>
<div class="line"><span class="comment">    printf(&quot;%.14e\n&quot;,n[trx-&gt;find_nuclide_guess(942390)]);</span></div>
<div class="line"><span class="comment">    printf(&quot;%.14e\n&quot;,n[trx-&gt;find_nuclide(3,541350)]);</span></div>
<div class="line"><span class="comment">    printf(&quot;%.14e\n&quot;,n[trx-&gt;find_nuclide(3,430990)]);</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line"></div>
<div class="line">    EXPECT_FLOAT_EQ( n[trx-&gt;find_nuclide_guess( 922350 )], 0.085176535 );</div>
<div class="line">    EXPECT_FLOAT_EQ( n[trx-&gt;find_nuclide_guess( 942390 )], 0.037553333 );</div>
<div class="line">    EXPECT_FLOAT_EQ( n[trx-&gt;find_nuclide( 3, 541350 )], 2.0385921e-06 );</div>
<div class="line">    EXPECT_FLOAT_EQ( n[trx-&gt;find_nuclide( 3, 430990 )], 0.00062933267 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check that removal gets set.</span></div>
<div class="line">    <span class="keywordtype">double</span> u236 = n[trx-&gt;find_nuclide_guess( 922360 )];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set removal.</span></div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Origen::Vec_Dbl</a> lambda( itot, 0.0 );</div>
<div class="line">    lambda[trx-&gt;find_nuclide_guess( 922360 )] = 1;  <span class="comment">// U-236 disappears fast</span></div>
<div class="line">    solver.<a name="a13"></a><a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a1a63c5e83563d564b31f5d3735650b30">set_continuous_loss</a>( &amp;lambda );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Solve.</span></div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#af4682463633952a2e3fd6477b3ed9318">solve</a>( n0, 3.5e14, dt, &amp;n ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check that U236 amount decreased.</span></div>
<div class="line">    EXPECT_TRUE( n[trx-&gt;find_nuclide_guess( 922360 )] &lt; 1e-5 * u236 );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/**************************************************************************/</span> <span class="comment">/**</span></div>
<div class="line"><span class="comment">  * \brief  Test the depletion tallies (mostly energy released)</span></div>
<div class="line"><span class="comment">  *****************************************************************************/</span></div>
<div class="line"><a class="code" href="../../d1/d37/tst_alpha_spectra_8cpp.html#a7e1214809c1b242829640bc65dba3e55">TEST</a>( Solver_cram, tallies )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="../../d4/d53/class_origen_1_1_solver__cram.html">Origen::Solver_cram</a> solver;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Load a library.</span></div>
<div class="line">    <a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a> lib;</div>
<div class="line">    ASSERT_TRUE( <a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#aeeab0b5173c8f0f318815516c66f96d1">Origen::FakeFactory::Library_scale_pwr</a>( lib ) );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#afb55bc73ff1ba4f1605a68227ee92603">Origen::TransitionMatrixP::SP</a> trx = lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#a977b919cc2065a44e3a8adfbe680eb49">newsp_transition_matrix_at</a>( 0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set the transition matrix.</span></div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#abe37ab3d53f6b75bd47836c0f1cb6c8c">set_transition_matrix</a>( &amp;*trx );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Turn the tallies on.</span></div>
<div class="line">    ScaleUtils::IO::DB opts;</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyEnergyReleased&quot;</span>, true );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumFissions&quot;</span>, true );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyNumCaptures&quot;</span>, true );</div>
<div class="line">    opts.set&lt;<span class="keywordtype">bool</span>&gt;( <span class="stringliteral">&quot;tallyAveConcentrations&quot;</span>, true );</div>
<div class="line">    solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#aae07a5e0a6d1d4ffa6b25feccbfb3e92">set_opts</a>( opts );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Step length &amp; neutron flux.</span></div>
<div class="line">    <span class="keywordtype">double</span> dt = 1 * 60 * 60 * 24;</div>
<div class="line">    <span class="keywordtype">double</span> flux = 3.5e14;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initial composition</span></div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Origen::Vec_Dbl</a> n0( trx-&gt;get_itot(), 0.0 );</div>
<div class="line">    n0[trx-&gt;find_nuclide_guess( 922350 )] = 0.05;</div>
<div class="line">    n0[trx-&gt;find_nuclide_guess( 922380 )] = 0.95;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Solve</span></div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Origen::Vec_Dbl</a> n( trx-&gt;get_itot(), 0.0 );</div>
<div class="line">    EXPECT_TRUE( solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#af4682463633952a2e3fd6477b3ed9318">solve</a>( n0, 3.5e14, dt, &amp;n ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get the tally results</span></div>
<div class="line">    <span class="keyword">const</span> ScaleUtils::IO::DB&amp; status = solver.<a class="code" href="../../d2/df0/class_origen_1_1_solver.html#a585cd31bba044ea2fead91ae062010c9">status</a>();</div>
<div class="line">    <span class="keywordtype">double</span> energy_tally = status.get&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;energyReleased&quot;</span> );</div>
<div class="line">    <span class="keywordtype">double</span> fission_tally = status.get&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;numFissions&quot;</span> );</div>
<div class="line">    <span class="keywordtype">double</span> capture_tally = status.get&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;numCaptures&quot;</span> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get the total power at BOS and EOS</span></div>
<div class="line">    <span class="keywordtype">double</span> BOS_power = trx-&gt;get_reaction_power( n0, 1, flux ) / 1e24;</div>
<div class="line">    <span class="keywordtype">double</span> EOS_power = trx-&gt;get_reaction_power( n, 1, flux ) / 1e24;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check that the energy tally is close. It should for such short step</span></div>
<div class="line">    <span class="keywordtype">double</span> energy_ref = dt * ( BOS_power + EOS_power ) / 2;</div>
<div class="line">    EXPECT_NEAR( energy_ref, energy_tally, energy_ref * 1e-3 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check that the other tallies returned something</span></div>
<div class="line">    EXPECT_GT( fission_tally, 0.0 );</div>
<div class="line">    EXPECT_LT( fission_tally, 1.0 );</div>
<div class="line">    EXPECT_GT( capture_tally, 0.0 );</div>
<div class="line">    EXPECT_LT( capture_tally, 1.0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check that the U238 Average concentration is reasnable</span></div>
<div class="line">    <span class="comment">// This is a one day depletion</span></div>
<div class="line">    <span class="keywordtype">double</span> u238 = status.get&lt;<span class="keywordtype">double</span>&gt;( <span class="stringliteral">&quot;ave_922380&quot;</span> );</div>
<div class="line">    EXPECT_LT( u238, 0.94999 );</div>
<div class="line">    EXPECT_GT( u238, 0.949 );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * The below part actually tests MultiZoneDepleter as much as Solver_matrex</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> ScaleUtils::IO::nprintf;</div>
<div class="line"></div>
<div class="line"><span class="comment">// GLOBAL COMMUNICATOR</span></div>
<div class="line">Standard::Communicator <a name="a14"></a><a class="code" href="../../d5/d3d/tst_multi_zone_depleter_8cpp.html#a3fbc6275638f2c6c543b3f46c7d6a9db">world</a>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a name="a15"></a><a class="code" href="../../d4/d7e/tst_solver__cram_8cpp.html#a6c4f5f1a81b5d1665e6d7ef5a04952a3">print_summary_1</a>( <a class="code" href="../../d5/dc1/namespace_origen.html#a55c03e9e8d89fdf39a370e8e83220fec">Origen::SP_Material</a> mat, std::string file )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> ntimes = mat-&gt;ntimes();</div>
<div class="line">    std::vector&lt;int&gt; ids, user_to_master, master_to_user;</div>
<div class="line">    <a name="a16"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#a3f5074a0309e7a45d83499d01b910c6e">Origen::FakeFactory::nuclide_set_addnux4</a>( ids );</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> w = 13;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pr = 3;</div>
<div class="line"></div>
<div class="line">    mat-&gt;mapping_sets( ids, &amp;user_to_master, &amp;master_to_user );</div>
<div class="line">    std::ofstream summary( file + <span class="stringliteral">&quot;_summary.txt&quot;</span> );</div>
<div class="line">    summary &lt;&lt; std::setw( 5 ) &lt;&lt; <span class="stringliteral">&quot;index&quot;</span> &lt;&lt; std::setw( 11 ) &lt;&lt; <span class="stringliteral">&quot;time(d)&quot;</span></div>
<div class="line">            &lt;&lt; std::setw( w ) &lt;&lt; <span class="stringliteral">&quot;power(W)&quot;</span> &lt;&lt; std::setw( w ) &lt;&lt; <span class="stringliteral">&quot;mass(g)&quot;</span></div>
<div class="line">            &lt;&lt; std::setw( w ) &lt;&lt; <span class="stringliteral">&quot;act(Bq)&quot;</span> &lt;&lt; std::setw( w ) &lt;&lt; <span class="stringliteral">&quot;xs(1/cm)&quot;</span></div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> p = 0; p &lt; ntimes; ++p )</div>
<div class="line">    {</div>
<div class="line">        std::vector&lt;double&gt; numden( ids.size() );</div>
<div class="line">        <a class="code" href="../../d5/dc1/namespace_origen.html#abf0a77d8892af68cbca20f3a4513fd75">Origen::SP_DoubleList</a> amount = mat-&gt;amount_at( p );</div>
<div class="line">        <span class="keywordtype">double</span> volume = mat-&gt;cold_volume();</div>
<div class="line">        mat-&gt;get_numden_at( &amp;numden, p, ids );</div>
<div class="line"></div>
<div class="line">        summary &lt;&lt; std::fixed &lt;&lt; std::setw( 5 ) &lt;&lt; ( p + 1 )</div>
<div class="line">                &lt;&lt; std::setprecision( 3 ) &lt;&lt; std::scientific &lt;&lt; std::setw( 11 )</div>
<div class="line">                &lt;&lt; mat-&gt;time_at( p ) / 86400. &lt;&lt; std::setw( w )</div>
<div class="line">                &lt;&lt; ( p == 0 ? 0.0 : mat-&gt;power_over( p - 1 ) );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// output number densities</span></div>
<div class="line">        {</div>
<div class="line">            std::stringstream ss;</div>
<div class="line">            ss &lt;&lt; file &lt;&lt; <span class="stringliteral">&quot;_nd_&quot;</span> &lt;&lt; std::setw( 2 ) &lt;&lt; std::setfill( <span class="charliteral">&#39;0&#39;</span> ) &lt;&lt; p</div>
<div class="line">               &lt;&lt; <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line">            std::ofstream ofs( ss.str() );</div>
<div class="line">            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; ids.size(); ++i )</div>
<div class="line">            {</div>
<div class="line">                ofs &lt;&lt; std::fixed &lt;&lt; std::setw( 3 ) &lt;&lt; ( i + 1 )</div>
<div class="line">                    &lt;&lt; std::setw( 9 ) &lt;&lt; ids[i] &lt;&lt; std::scientific</div>
<div class="line">                    &lt;&lt; std::setprecision( 5 ) &lt;&lt; std::setw( 15 ) &lt;&lt; numden[i]</div>
<div class="line">                    &lt;&lt; std::endl;</div>
<div class="line">            }</div>
<div class="line">            ofs.close();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// output number densities</span></div>
<div class="line">        {</div>
<div class="line">            std::stringstream ss;</div>
<div class="line">            std::vector&lt;double&gt; numden_all( mat-&gt;total_nuclides() );</div>
<div class="line">            mat-&gt;get_numden_at( &amp;numden_all, p );</div>
<div class="line">            ss &lt;&lt; file &lt;&lt; <span class="stringliteral">&quot;_nda_&quot;</span> &lt;&lt; std::setw( 2 ) &lt;&lt; std::setfill( <span class="charliteral">&#39;0&#39;</span> ) &lt;&lt; p</div>
<div class="line">               &lt;&lt; <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line">            std::ofstream ofs( ss.str() );</div>
<div class="line">            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; numden_all.size(); ++i )</div>
<div class="line">            {</div>
<div class="line">                ofs &lt;&lt; std::scientific &lt;&lt; std::setprecision( 5 )</div>
<div class="line">                    &lt;&lt; std::setw( 15 ) &lt;&lt; numden_all[i] &lt;&lt; std::endl;</div>
<div class="line">            }</div>
<div class="line">            ofs.close();</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// output masses in grams</span></div>
<div class="line">        {</div>
<div class="line">            std::stringstream ss;</div>
<div class="line">            ss &lt;&lt; file &lt;&lt; <span class="stringliteral">&quot;_m_&quot;</span> &lt;&lt; std::setw( 2 ) &lt;&lt; std::setfill( <span class="charliteral">&#39;0&#39;</span> ) &lt;&lt; p</div>
<div class="line">               &lt;&lt; <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line">            std::ofstream ofs( ss.str() );</div>
<div class="line">            <span class="keywordtype">double</span> mass_sum = 0.0;</div>
<div class="line">            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; ids.size(); ++i )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">int</span> m = user_to_master[i];</div>
<div class="line">                <span class="keywordtype">double</span> mass =</div>
<div class="line">                    m &lt; 0 ? 0.0 : mat-&gt;library()-&gt;decay_data().masses[m];</div>
<div class="line">                <span class="keywordtype">double</span> val = numden[i] * volume * mass / 0.60221413;</div>
<div class="line">                ofs &lt;&lt; std::fixed &lt;&lt; std::setw( 3 ) &lt;&lt; ( i + 1 )</div>
<div class="line">                    &lt;&lt; std::setw( 9 ) &lt;&lt; ids[i] &lt;&lt; std::scientific</div>
<div class="line">                    &lt;&lt; std::setprecision( 5 ) &lt;&lt; std::setw( 15 ) &lt;&lt; val</div>
<div class="line">                    &lt;&lt; std::endl;</div>
<div class="line">                mass_sum += val;</div>
<div class="line">            }</div>
<div class="line">            summary &lt;&lt; std::setprecision( pr ) &lt;&lt; std::scientific</div>
<div class="line">                    &lt;&lt; std::setw( w ) &lt;&lt; mass_sum;</div>
<div class="line">            ofs.close();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// output activities</span></div>
<div class="line">        {</div>
<div class="line">            std::stringstream ss;</div>
<div class="line">            ss &lt;&lt; file &lt;&lt; <span class="stringliteral">&quot;_bq_&quot;</span> &lt;&lt; std::setw( 2 ) &lt;&lt; std::setfill( <span class="charliteral">&#39;0&#39;</span> ) &lt;&lt; p</div>
<div class="line">               &lt;&lt; <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line">            std::ofstream ofs( ss.str() );</div>
<div class="line">            <span class="keywordtype">double</span> bq_sum = 0.0;</div>
<div class="line">            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; ids.size(); ++i )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">int</span> m = user_to_master[i];</div>
<div class="line">                <span class="keywordtype">double</span> lambda =</div>
<div class="line">                    m &lt; 0 ? 0.0</div>
<div class="line">                          : mat-&gt;library()-&gt;decay_data().decay_constants[m];</div>
<div class="line">                <span class="keywordtype">double</span> val = 0.60221413e+23 * numden[i] * volume * lambda;</div>
<div class="line">                ofs &lt;&lt; std::fixed &lt;&lt; std::setw( 3 ) &lt;&lt; ( i + 1 )</div>
<div class="line">                    &lt;&lt; std::setw( 9 ) &lt;&lt; ids[i] &lt;&lt; std::scientific</div>
<div class="line">                    &lt;&lt; std::setprecision( 5 ) &lt;&lt; std::setw( 15 ) &lt;&lt; val</div>
<div class="line">                    &lt;&lt; std::endl;</div>
<div class="line">                bq_sum += val;</div>
<div class="line">            }</div>
<div class="line">            summary &lt;&lt; std::setprecision( pr ) &lt;&lt; std::scientific</div>
<div class="line">                    &lt;&lt; std::setw( w ) &lt;&lt; bq_sum;</div>
<div class="line">            ofs.close();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// output macros</span></div>
<div class="line">        {</div>
<div class="line">            std::stringstream ss;</div>
<div class="line">            ss &lt;&lt; file &lt;&lt; <span class="stringliteral">&quot;_xs_&quot;</span> &lt;&lt; std::setw( 2 ) &lt;&lt; std::setfill( <span class="charliteral">&#39;0&#39;</span> ) &lt;&lt; p</div>
<div class="line">               &lt;&lt; <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line">            std::ofstream ofs( ss.str() );</div>
<div class="line">            <span class="keywordtype">double</span> <a name="a17"></a><a class="code" href="../../da/d97/tst_reaction_resource_i_o_8cpp.html#a9bd9c096d0c0331784133cb114c7ae85">xs_sum</a> = 0;</div>
<div class="line">            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; ids.size(); ++i )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">int</span> m = user_to_master[i];</div>
<div class="line">                <span class="keywordtype">double</span> sigma =</div>
<div class="line">                    m &lt; 0</div>
<div class="line">                        ? 0.0</div>
<div class="line">                        : mat-&gt;library()-&gt;transition_coeff_at( 0 ).loss_xs().at(</div>
<div class="line">                              m );</div>
<div class="line">                <span class="keywordtype">double</span> val = numden[i] * sigma;</div>
<div class="line">                ofs &lt;&lt; std::fixed &lt;&lt; std::setw( 3 ) &lt;&lt; ( i + 1 )</div>
<div class="line">                    &lt;&lt; std::setw( 9 ) &lt;&lt; ids[i] &lt;&lt; std::scientific</div>
<div class="line">                    &lt;&lt; std::setprecision( 5 ) &lt;&lt; std::setw( 15 ) &lt;&lt; val</div>
<div class="line">                    &lt;&lt; std::endl;</div>
<div class="line">                xs_sum += val;</div>
<div class="line">            }</div>
<div class="line">            summary &lt;&lt; std::setprecision( pr ) &lt;&lt; std::scientific</div>
<div class="line">                    &lt;&lt; std::setw( w ) &lt;&lt; <a class="code" href="../../da/d97/tst_reaction_resource_i_o_8cpp.html#a9bd9c096d0c0331784133cb114c7ae85">xs_sum</a>;</div>
<div class="line">            ofs.close();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        summary &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/**************************************************************************/</span> <span class="comment">/**</span></div>
<div class="line"><span class="comment">  * \brief  Test through the MultiZoneDepleter class.</span></div>
<div class="line"><span class="comment">  *****************************************************************************/</span></div>
<div class="line"><a class="code" href="../../d1/d37/tst_alpha_spectra_8cpp.html#a7e1214809c1b242829640bc65dba3e55">TEST</a>( CycleDepletion, SingleMaterial )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Get a transition matrix and library.</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a7a406c531668ac8d63ce2e70eb1b38f4">Origen::SP_TransitionMatrixP</a> trx;</div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#aa3ba24879f383fe079561477ccb875cb">Origen::SP_Library</a> lib = std::make_shared&lt;Origen::Library&gt;();</div>
<div class="line">    {</div>
<div class="line">        ASSERT_TRUE( <a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#aeeab0b5173c8f0f318815516c66f96d1">Origen::FakeFactory::Library_scale_pwr</a>( *lib ) );</div>
<div class="line">        trx = lib-&gt;newsp_transition_matrix_at( 0 );</div>
<div class="line">    }</div>
<div class="line">    jDebugTaggedLine( <span class="stringliteral">&quot;finished SetUp&quot;</span> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Setup materials.</span></div>
<div class="line">    <span class="keywordtype">int</span> id1 = 1;</div>
<div class="line">    <span class="comment">// double assembly_mass = 0.4; //MTU</span></div>
<div class="line">    <span class="keywordtype">double</span> total_mass = 0.4 / 0.8815;         <span class="comment">// MT</span></div>
<div class="line">    <span class="keywordtype">double</span> volume = total_mass * 1e6 / 10.2;  <span class="comment">// 10.2 g/cc</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create first begining-of-step number density.</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a55c03e9e8d89fdf39a370e8e83220fec">Origen::SP_Material</a> mat1 = std::make_shared&lt;Origen::Material&gt;(</div>
<div class="line">        <span class="stringliteral">&quot;GENERAL&quot;</span>, lib, <span class="stringliteral">&quot;mat1&quot;</span>, id1, volume );</div>
<div class="line">    std::vector&lt;int&gt; ids;</div>
<div class="line">    std::vector&lt;double&gt; numden;</div>
<div class="line">    <a name="a18"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#a32955ef2509f74b312d8b7b3110c16a8">Origen::FakeFactory::vera_uox_e360</a>( ids, numden );</div>
<div class="line">    mat1-&gt;set_numden_bos( numden, ids );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Associate materials with map.</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a5bae16b6dbc998d03ea075b3290a1b91">Origen::SP_MaterialMap</a> matmap = std::make_shared&lt;Origen::MaterialMap&gt;();</div>
<div class="line">    matmap-&gt;add( mat1 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create depletion times/fluxes.</span></div>
<div class="line">    <span class="comment">//                          cycle1--------------&gt; cycle2---------------&gt;</span></div>
<div class="line">    <span class="comment">//                          deplete------&gt;decay-&gt; deplete-----&gt;decay---&gt;</span></div>
<div class="line">    std::vector&lt;double&gt; time{</div>
<div class="line">        0, 3, 250, 500, 515, 530, 533, 780, 1030, 1045, 1060};</div>
<div class="line">    std::vector&lt;double&gt; flux{4, 4, 4, 0, 0, 3, 3, 3, 0, 0};</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> j = 0; j &lt; time.size(); ++j ) time[j] *= 86400.0;</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> j = 0; j &lt; flux.size(); ++j ) flux[j] *= 1.0e14;</div>
<div class="line">    <span class="keywordtype">size_t</span> nsteps = flux.size();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create step depleter.</span></div>
<div class="line">    DataContainer dc;</div>
<div class="line">    <a name="_a19"></a><a class="code" href="../../d4/d0c/class_origen_1_1_multi_zone_depleter.html">Origen::MultiZoneDepleter</a> mzd;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set solver</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a9da6dd730b150000ffb0235d3c8a0c22">Origen::SP_Solver</a> slv( <span class="keyword">new</span> <a class="code" href="../../d4/d53/class_origen_1_1_solver__cram.html">Origen::Solver_cram</a>() );</div>
<div class="line">    mzd.<a name="a20"></a><a class="code" href="../../d4/d0c/class_origen_1_1_multi_zone_depleter.html#a900c4ac4ba5ae27bd02bacf4dee0a1b1">set_solver</a>( slv );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set materials</span></div>
<div class="line">    mzd.<a name="a21"></a><a class="code" href="../../d4/d0c/class_origen_1_1_multi_zone_depleter.html#a894b9b129ce6272d01bb9d8d62cc6084">set_materials</a>( matmap );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Enter step loop.</span></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> j = 0; j &lt; nsteps; ++j )</div>
<div class="line">    {</div>
<div class="line">        std::stringstream ss;</div>
<div class="line">        ss &lt;&lt; <span class="stringliteral">&quot;loop(&quot;</span> &lt;&lt; std::setw( 3 ) &lt;&lt; std::setfill( <span class="charliteral">&#39;0&#39;</span> ) &lt;&lt; ( j + 1 )</div>
<div class="line">           &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">        SCOPED_TIMER( ss.str() );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Add new step data.</span></div>
<div class="line">        <span class="keywordtype">double</span> stepTime = time[j + 1] - time[j];</div>
<div class="line">        mzd.<a name="a22"></a><a class="code" href="../../d4/d0c/class_origen_1_1_multi_zone_depleter.html#a55669259c86b01befd75b8d81502170d">add_step</a>( stepTime );</div>
<div class="line">        mat1-&gt;set_flux( flux[j] );</div>
<div class="line">        mat1-&gt;set_transition_matrix( trx );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Update data container.</span></div>
<div class="line">        dc.addInt( <span class="stringliteral">&quot;numSubsteps&quot;</span>, 1 );</div>
<div class="line">        dc.addDouble( <span class="stringliteral">&quot;stepTime&quot;</span>, stepTime );</div>
<div class="line">        dc.addBool( <span class="stringliteral">&quot;depleteByPower&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line">        mzd.<a name="a23"></a><a class="code" href="../../d4/d0c/class_origen_1_1_multi_zone_depleter.html#a04c28f4e34f3f4432d71f54c5fcf3550">update</a>( dc );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Step in time.</span></div>
<div class="line">        mzd.<a name="a24"></a><a class="code" href="../../d4/d0c/class_origen_1_1_multi_zone_depleter.html#ae006844a02161d12182ab372ca5c257b">execute</a>();</div>
<div class="line"></div>
<div class="line">        EXPECT_FLOAT_EQ( stepTime, mat1-&gt;dt() );</div>
<div class="line">        EXPECT_FLOAT_EQ( flux[j], mat1-&gt;flux() );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Step output.</span></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        std::cout &lt;&lt; std::fixed &lt;&lt;</span></div>
<div class="line"><span class="comment">                  &quot; step=&quot;&lt;&lt; std::setw(3) &lt;&lt; (j+1)&lt;&lt;</span></div>
<div class="line"><span class="comment">                  std::scientific &lt;&lt; std::setprecision(2) &lt;&lt;</span></div>
<div class="line"><span class="comment">                  &quot; dt=&quot;&lt;&lt;mat1-&gt;dt()&lt;&lt;</span></div>
<div class="line"><span class="comment">                  &quot; flux=&quot;&lt;&lt; mat1-&gt;flux()&lt;&lt;</span></div>
<div class="line"><span class="comment">                  &quot; power=&quot;&lt;&lt; mat1-&gt;power()&lt;&lt;</span></div>
<div class="line"><span class="comment">                  std::endl;</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Print nuclides of interest.</span></div>
<div class="line">    <a class="code" href="../../d4/d7e/tst_solver__cram_8cpp.html#a6c4f5f1a81b5d1665e6d7ef5a04952a3">print_summary_1</a>( mat1, <span class="stringliteral">&quot;base&quot;</span> );</div>
<div class="line"></div>
<div class="line">    std::ofstream ofs( <span class="stringliteral">&quot;matmap.txt&quot;</span> );</div>
<div class="line">    ofs &lt;&lt; matmap-&gt;to_string();</div>
<div class="line">    ofs.close();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// timing table</span></div>
<div class="line">    <a name="a25"></a><a class="code" href="../../d5/dc1/namespace_origen.html#af1145aecbf23fda29398fa71fe1c8dda">Origen::printTimingReport</a>( std::cout );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// wrapup</span></div>
<div class="line">    dc.deepDelete();</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
