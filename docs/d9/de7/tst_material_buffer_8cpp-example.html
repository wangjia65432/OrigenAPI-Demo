<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.10"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>ORIGEN API: tstMaterialBuffer.cpp</title>
        <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="../../dynsections.js"></script>
        <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
        <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
        <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">ORIGEN API v0.5.2</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Overview</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../modules.html"><span>Components</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../d1/d5b/md__c_h_a_n_g_e_l_o_g.html"><span>Changelog</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tstMaterialBuffer.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>./Core/io/tests/tstMaterialBuffer.cpp</p>
<div class="fragment"><div class="line"><span class="comment">// This test is not a part of the ORIGEN API in SCALE 6.2. It tests the ability</span></div>
<div class="line"><span class="comment">// to read/write HDF5 versions of the Origen::Material to disk. This was</span></div>
<div class="line"><span class="comment">// envisioned</span></div>
<div class="line"><span class="comment">// as a way to buffer the contents of the Origen::Material to disk, but was</span></div>
<div class="line"><span class="comment">// not fully implemented. For now, it is the Origen::Material user&#39;s</span></div>
<div class="line"><span class="comment">// responsibility.  The following related files are copied and pasted here.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// FILE: Origen/Core/io/MaterialBuffer.h</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// #ifndef Origen_MaterialBuffer_H</span></div>
<div class="line"><span class="comment">// #define Origen_MaterialBuffer_H</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// #include &quot;Origen/Core/dc/Material.h&quot;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// namespace Origen {</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// class MaterialBuffer {</span></div>
<div class="line"><span class="comment">// public:</span></div>
<div class="line"><span class="comment">//     bool initialize_file(std::string file, const Material&amp; mat, bool</span></div>
<div class="line"><span class="comment">//     overwrite=false);</span></div>
<div class="line"><span class="comment">//     bool dump_range(int pstart, int pend, std::string file, Material* mat);</span></div>
<div class="line"><span class="comment">//     bool retrieve_range(int pstart, int pend, std::string file, Material*</span></div>
<div class="line"><span class="comment">//     mat);</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//     virtual ~MaterialBuffer(){}</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// private:</span></div>
<div class="line"><span class="comment">//     virtual bool initialize_file_impl(std::string file, const Material&amp; mat,</span></div>
<div class="line"><span class="comment">//     bool overwrite);</span></div>
<div class="line"><span class="comment">//     virtual bool dump_range_impl(int pstart, int pend, std::string file,</span></div>
<div class="line"><span class="comment">//     Material* mat);</span></div>
<div class="line"><span class="comment">//     virtual bool retrieve_range_impl(int pstart, int pend, std::string file,</span></div>
<div class="line"><span class="comment">//     Material* mat);</span></div>
<div class="line"><span class="comment">// };</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// typedef std::shared_ptr&lt;MaterialBuffer&gt; SP_MaterialBuffer;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// }</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// #endif</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// FILE: Origen/Core/io/MaterialBuffer.cpp</span></div>
<div class="line"><span class="comment">// #include &quot;Origen/Core/io/MaterialBuffer.h&quot;</span></div>
<div class="line"><span class="comment">// #include &quot;ScaleUtils/IO/DB.h&quot;</span></div>
<div class="line"><span class="comment">// #include &lt;ostream&gt;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// namespace Origen {</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer::initialize_file(std::string file,</span></div>
<div class="line"><span class="comment">//         const Material&amp; mat,</span></div>
<div class="line"><span class="comment">//         bool overwrite){</span></div>
<div class="line"><span class="comment">//             return initialize_file_impl(file,mat,overwrite);</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer::dump_range(int pstart, int pend, std::string</span></div>
<div class="line"><span class="comment">//         file, Material* mat){</span></div>
<div class="line"><span class="comment">//             return dump_range_impl(pstart,pend,file,mat);</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer::retrieve_range(int pstart, int pend, std::string</span></div>
<div class="line"><span class="comment">//         file, Material* mat){</span></div>
<div class="line"><span class="comment">//             return retrieve_range_impl(pstart,pend,file,mat);</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer::initialize_file_impl(std::string file,</span></div>
<div class="line"><span class="comment">//         const Material&amp; mat,</span></div>
<div class="line"><span class="comment">//         bool overwrite){</span></div>
<div class="line"><span class="comment">//             ScaleUtils::IO::DB opts;</span></div>
<div class="line"><span class="comment">//             std::ofstream ofs;</span></div>
<div class="line"><span class="comment">//             bool status = opts.prepareBinaryFileWrite(ofs,file);</span></div>
<div class="line"><span class="comment">//             return status;</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer::dump_range_impl(int pstart, int pend,</span></div>
<div class="line"><span class="comment">//         std::string file, Material* mat){</span></div>
<div class="line"><span class="comment">//             return false;</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer::retrieve_range_impl(int pstart, int pend,</span></div>
<div class="line"><span class="comment">//         std::string file, Material* mat){</span></div>
<div class="line"><span class="comment">//             return false;</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">// }</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// FILE: Origen/Core/io/MaterialBuffer_hdf5.h</span></div>
<div class="line"><span class="comment">// #include &quot;Origen/Core/io/MaterialBuffer.h&quot;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// namespace Origen {</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// class MaterialBuffer_hdf5 : public MaterialBuffer {</span></div>
<div class="line"><span class="comment">// private:</span></div>
<div class="line"><span class="comment">//         virtual bool initialize_file_impl(std::string file, const Material&amp;</span></div>
<div class="line"><span class="comment">//         mat, bool overwrite);</span></div>
<div class="line"><span class="comment">//         virtual bool dump_range_impl(size_t pstart, size_t pend, std::string</span></div>
<div class="line"><span class="comment">//         file, Material* mat);</span></div>
<div class="line"><span class="comment">//         virtual bool retrieve_range_impl(size_t pstart, size_t pend,</span></div>
<div class="line"><span class="comment">//         std::string file, Material* mat);</span></div>
<div class="line"><span class="comment">// };</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// }</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// FILE: Origen/Core/io/MaterialBuffer_hdf5.cpp</span></div>
<div class="line"><span class="comment">// #include &quot;ScaleUtils/IO/DB.h&quot;</span></div>
<div class="line"><span class="comment">// #include &quot;Origen/Core/io/MaterialBuffer_hdf5.h&quot;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// //#include &lt;hdf5.h&gt;</span></div>
<div class="line"><span class="comment">// //#include &lt;hdf5_hl.h&gt;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// namespace Origen {</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer_hdf5::initialize_file_impl(std::string file,</span></div>
<div class="line"><span class="comment">//         const Material&amp; mat, bool overwrite){</span></div>
<div class="line"><span class="comment">//             ScaleUtils::IO::DB opts;</span></div>
<div class="line"><span class="comment">//             std::ofstream ofs;</span></div>
<div class="line"><span class="comment">//             bool status = false;</span></div>
<div class="line"><span class="comment">//             std::string path;</span></div>
<div class="line"><span class="comment">//             if( file==&quot;&quot; ){</span></div>
<div class="line"><span class="comment">//                 path=mat.name()+&quot;.h5&quot;;</span></div>
<div class="line"><span class="comment">//             }</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// //            hid_t result;</span></div>
<div class="line"><span class="comment">//             jDebugLine(&quot;creating path={&quot;&lt;&lt;path&lt;&lt;&quot;}&quot;);</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// //            if( overwrite ){</span></div>
<div class="line"><span class="comment">// //                result = H5Fopen(path.c_str(), H5F_ACC_TRUNC, H5P_DEFAULT);</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// //                // scalar dimensions</span></div>
<div class="line"><span class="comment">// //                hsize_t dims[1] = {1};</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// //                // write the data</span></div>
<div class="line"><span class="comment">// //                int total_nuclides = mat.total_nuclides();</span></div>
<div class="line"><span class="comment">// //                H5LTmake_dataset_int(result, &quot;total_nuclides&quot;, 1, dims,</span></div>
<div class="line"><span class="comment">// &amp;total_nuclides);</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// //            } else {</span></div>
<div class="line"><span class="comment">// //                result = H5Fopen(path.c_str(), H5F_ACC_TRUNC, H5P_DEFAULT);</span></div>
<div class="line"><span class="comment">// //            }</span></div>
<div class="line"><span class="comment">// //            result = H5Fcreate (path.c_str() , H5F_ACC_EXCL,</span></div>
<div class="line"><span class="comment">// //                  H5P_DEFAULT, H5P_DEFAULT);</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// //            H5Fclose(result);</span></div>
<div class="line"><span class="comment">//             //status = opts.prepareTextFileWrite(ofs,path);</span></div>
<div class="line"><span class="comment">//             //if( !status )return status;</span></div>
<div class="line"><span class="comment">//             return status;</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer_hdf5::dump_range_impl(size_t pstart, size_t pend,</span></div>
<div class="line"><span class="comment">//         std::string file, Material* mat){</span></div>
<div class="line"><span class="comment">//             return false;</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">//         bool MaterialBuffer_hdf5::retrieve_range_impl(size_t pstart, size_t</span></div>
<div class="line"><span class="comment">//         pend, std::string file, Material* mat){</span></div>
<div class="line"><span class="comment">//             return false;</span></div>
<div class="line"><span class="comment">//         }</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// }</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;Nemesis/gtest/nemesis_gtest.hh&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Nemesis/harness/DBC.hh&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Origen/Core/TestPaths.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d3/ddd/_fake_factory_8h.html">Origen/Core/dc/FakeFactory.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d3/d09/_material_8h.html">Origen/Core/dc/Material.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d7/de0/_material_map_8h.html">Origen/Core/dc/MaterialMap.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> std::string;</div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> std::map&lt;std::string, Origen::SP_Library&gt; <a name="a0"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a90762cbc8b668e34f864aed04d71115e">LibraryMap_t</a>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;hdf5.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;hdf5_hl.h&gt;</span></div>
<div class="line"></div>
<div class="line">hid_t <a name="a1"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#ab63cc3f19b86fa104f313ea75abb00db">h5_group_handle</a>( hid_t parent, <span class="keyword">const</span> <span class="keywordtype">char</span>* name )</div>
<div class="line">{</div>
<div class="line">    Require( parent &gt; 0 );</div>
<div class="line">    hid_t g;</div>
<div class="line">    htri_t exists = H5Lexists( parent, name, H5P_DEFAULT );</div>
<div class="line">    <span class="keywordflow">if</span>( exists )</div>
<div class="line">    {</div>
<div class="line">        g = H5Gopen1( parent, name );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        g = H5Gcreate1( parent, name, 0 );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> g;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">herr_t <a name="a2"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a657001d8846e63490259c1d28771c68d">h5_write_units</a>( hid_t dataset, <span class="keyword">const</span> <span class="keywordtype">char</span>* units )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// create a space padded string for 32 characters of units info</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> UNITS_SIZE( 32 );</div>
<div class="line">    std::string sunits( units );</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = sunits.size(); i &lt; UNITS_SIZE; ++i )</div>
<div class="line">    {</div>
<div class="line">        sunits += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// handle units</span></div>
<div class="line">    htri_t exists = H5Aexists( dataset, <span class="stringliteral">&quot;units&quot;</span> );</div>
<div class="line">    herr_t status = 0;</div>
<div class="line">    <span class="keywordflow">if</span>( !exists )</div>
<div class="line">    {</div>
<div class="line">        hid_t dataspace = H5Screate( H5S_SCALAR );</div>
<div class="line">        hid_t type = H5Tcopy( H5T_C_S1 );</div>
<div class="line"></div>
<div class="line">        status = H5Tset_size( type, UNITS_SIZE + 1 );</div>
<div class="line">        Check( status &gt;= 0 );</div>
<div class="line"></div>
<div class="line">        status = H5Tset_strpad( type, H5T_STR_NULLTERM );</div>
<div class="line">        Check( status &gt;= 0 );</div>
<div class="line"></div>
<div class="line">        hid_t att = H5Acreate2(</div>
<div class="line">            dataset, <span class="stringliteral">&quot;units&quot;</span>, type, dataspace, H5P_DEFAULT, H5P_DEFAULT );</div>
<div class="line"></div>
<div class="line">        status = H5Awrite( att, type, sunits.c_str() );</div>
<div class="line">        H5Tclose( type );</div>
<div class="line">        H5Aclose( att );</div>
<div class="line">        H5Sclose( dataspace );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">//! create a new dataset</span></div>
<div class="line"><span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">hid_t <a name="a3"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a3ef5846ef7139cebf94935b6efd96a9a">h5_create_dataset</a>(</div>
<div class="line">    hid_t g, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, hsize_t rank, hsize_t* dims, <a name="_a4"></a><a class="code" href="../../db/d4f/class_origen_1_1_quantity.html">T</a> type_match );</div>
<div class="line"></div>
<div class="line"><span class="comment">// for doubles</span></div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line">hid_t <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a3ef5846ef7139cebf94935b6efd96a9a">h5_create_dataset</a>(</div>
<div class="line">    hid_t g, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, hsize_t rank, hsize_t* dims, <span class="keywordtype">double</span> type_match )</div>
<div class="line">{</div>
<div class="line">    hid_t dataspace = H5Screate_simple( rank, dims, <span class="keyword">nullptr</span> );</div>
<div class="line">    hid_t datatype = H5Tcopy( H5T_NATIVE_DOUBLE );</div>
<div class="line">    hid_t dataset = H5Dcreate(</div>
<div class="line">        g, name, datatype, dataspace, H5P_DEFAULT, H5P_DEFAULT, H5P_DEFAULT );</div>
<div class="line">    H5Sclose( dataspace );</div>
<div class="line">    H5Tclose( datatype );</div>
<div class="line">    <span class="keywordflow">return</span> dataset;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// for floats</span></div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line">hid_t <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a3ef5846ef7139cebf94935b6efd96a9a">h5_create_dataset</a>(</div>
<div class="line">    hid_t g, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, hsize_t rank, hsize_t* dims, <span class="keywordtype">float</span> type_match )</div>
<div class="line">{</div>
<div class="line">    hid_t dataspace = H5Screate_simple( rank, dims, <span class="keyword">nullptr</span> );</div>
<div class="line">    hid_t datatype = H5Tcopy( H5T_NATIVE_FLOAT );</div>
<div class="line">    hid_t dataset = H5Dcreate(</div>
<div class="line">        g, name, datatype, dataspace, H5P_DEFAULT, H5P_DEFAULT, H5P_DEFAULT );</div>
<div class="line">    H5Sclose( dataspace );</div>
<div class="line">    H5Tclose( datatype );</div>
<div class="line">    <span class="keywordflow">return</span> dataset;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// write to an existing dataset</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">herr_t <a name="a5"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#ad10830a4fc2b7e3eebb9ffb767e0fc90">h5_write_dataset</a>( hid_t dataset, <span class="keyword">const</span> <a class="code" href="../../db/d4f/class_origen_1_1_quantity.html">T</a>* first );</div>
<div class="line"></div>
<div class="line"><span class="comment">// for doubles</span></div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line">herr_t <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#ad10830a4fc2b7e3eebb9ffb767e0fc90">h5_write_dataset</a>( hid_t dataset, <span class="keyword">const</span> <span class="keywordtype">double</span>* first )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> H5Dwrite(</div>
<div class="line">        dataset, H5T_NATIVE_DOUBLE, H5S_ALL, H5S_ALL, H5P_DEFAULT, first );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// for doubles</span></div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line">herr_t <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#ad10830a4fc2b7e3eebb9ffb767e0fc90">h5_write_dataset</a>( hid_t dataset, <span class="keyword">const</span> <span class="keywordtype">float</span>* first )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> H5Dwrite(</div>
<div class="line">        dataset, H5T_NATIVE_FLOAT, H5S_ALL, H5S_ALL, H5P_DEFAULT, first );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// update an existing or write a new dataset</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">herr_t <a name="a6"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( hid_t g,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">char</span>* name,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">char</span>* units,</div>
<div class="line">                          hsize_t rank,</div>
<div class="line">                          hsize_t* dims,</div>
<div class="line">                          <a class="code" href="../../db/d4f/class_origen_1_1_quantity.html">T</a>* first )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// check if dataset exists</span></div>
<div class="line">    htri_t exists = H5Lexists( g, name, H5P_DEFAULT );</div>
<div class="line"></div>
<div class="line">    herr_t status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// if it doesn&#39;t then create a new one</span></div>
<div class="line">    hid_t dataset;</div>
<div class="line">    <span class="keywordflow">if</span>( !exists )</div>
<div class="line">    {</div>
<div class="line">        jDebugLine( <span class="stringliteral">&quot;   creating new dataset&quot;</span> );</div>
<div class="line">        dataset = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a3ef5846ef7139cebf94935b6efd96a9a">h5_create_dataset</a>( g, name, rank, dims, first[0] );</div>
<div class="line">        herr_t astatus = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a657001d8846e63490259c1d28771c68d">h5_write_units</a>( dataset, units );</div>
<div class="line">        Check( astatus &gt;= 0 );</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// if it does then open</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        dataset = H5Dopen( g, name, H5P_DEFAULT );</div>
<div class="line">    }</div>
<div class="line">    Check( dataset &gt; 0 );</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#ad10830a4fc2b7e3eebb9ffb767e0fc90">h5_write_dataset</a>( dataset, first );</div>
<div class="line"></div>
<div class="line">    H5Dclose( dataset );</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">hid_t <a name="a7"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a20fe7eeaf1b511281de0e3433bf94fb0">h5_write_trx</a>( <span class="keyword">const</span> <a name="_a8"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html">Origen::TransitionMatrixP</a>&amp; trx, hid_t g_step )</div>
<div class="line">{</div>
<div class="line">    jDebugLine( <span class="stringliteral">&quot;      write_trx&quot;</span> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// convenience</span></div>
<div class="line">    herr_t status;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    hsize_t dims_nd[] = {(hsize_t)trx.<a name="a9"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#a1449e4fbb3a0e4db78f29723b39210b4">get_itot</a>()};</div>
<div class="line">    hsize_t dims[] = {1};</div>
<div class="line"></div>
<div class="line">    <span class="comment">// transition matrix over the step is a group</span></div>
<div class="line">    hid_t g_trx = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#ab63cc3f19b86fa104f313ea75abb00db">h5_group_handle</a>( g_step, <span class="stringliteral">&quot;TransitionMatrix&quot;</span> );</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;g_trx=&quot;</span> &lt;&lt; g_trx &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// number of lite</span></div>
<div class="line">    i = trx.<a name="a10"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#aa223ab35d08b4be2e4bfa10b3086f24c">get_ilite</a>();</div>
<div class="line">    status = H5LTmake_dataset_int( g_trx, <span class="stringliteral">&quot;num_lite_nuclides&quot;</span>, 1, dims, &amp;i );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// number of actinides</span></div>
<div class="line">    i = trx.<a name="a11"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#abc5880ad525ae3c45e4af17d7c3db0b2">get_iact</a>();</div>
<div class="line">    hsize_t dims_fisxs[] = {(hsize_t)i};</div>
<div class="line">    status =</div>
<div class="line">        H5LTmake_dataset_int( g_trx, <span class="stringliteral">&quot;num_actinide_nuclides&quot;</span>, 1, dims, &amp;i );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// number of fission products</span></div>
<div class="line">    i = trx.<a name="a12"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#ad6c9ff593584db42a07a15532c4ec30e">get_ifp</a>();</div>
<div class="line">    status = H5LTmake_dataset_int(</div>
<div class="line">        g_trx, <span class="stringliteral">&quot;num_fission_product_nuclides&quot;</span>, 1, dims, &amp;i );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// total capture</span></div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>(</div>
<div class="line">        g_trx, <span class="stringliteral">&quot;loxs&quot;</span>, <span class="stringliteral">&quot;barn&quot;</span>, 1, dims_nd, &amp;trx.<a name="a13"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#aa9c1a6cde4220d3ce013608a10efc70a">get_tocap</a>()-&gt;at( 0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// fission</span></div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>(</div>
<div class="line">        g_trx, <span class="stringliteral">&quot;fisxs&quot;</span>, <span class="stringliteral">&quot;barn&quot;</span>, 1, dims_fisxs, &amp;trx.<a name="a14"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#ad91f91fd24f4b5286ab5dc2296ad8bed">get_fiss</a>()-&gt;at( 0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// a-matrix</span></div>
<div class="line">    hsize_t dims_t[] = {(hsize_t)trx.<a name="a15"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#a9e0afbf99486c18467e412e17b25ccd6">get_a</a>()-&gt;size()};</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>(</div>
<div class="line">        g_trx, <span class="stringliteral">&quot;coeff&quot;</span>, <span class="stringliteral">&quot;1/s&quot;</span>, 1, dims_t, &amp;trx.<a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#a9e0afbf99486c18467e412e17b25ccd6">get_a</a>()-&gt;at( 0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// flux spectrum</span></div>
<div class="line">    hsize_t dims_ng[] = {(hsize_t)trx.<a name="a16"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#ad6030cb28c04ee5f965a42860cbd9402">get_nfluxgrp</a>()};</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_trx,</div>
<div class="line">                                <span class="stringliteral">&quot;spectrum&quot;</span>,</div>
<div class="line">                                <span class="stringliteral">&quot;1/cm2-s&quot;</span>,</div>
<div class="line">                                1,</div>
<div class="line">                                dims_ng,</div>
<div class="line">                                &amp;trx.<a name="a17"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#af65e5a5950e400fbf24deceab42278f0">get_spectrum</a>()-&gt;at( 0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// neutron yields</span></div>
<div class="line">    hsize_t dims_n[] = {( hsize_t )( trx.<a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#abc5880ad525ae3c45e4af17d7c3db0b2">get_iact</a>() + trx.<a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#aa223ab35d08b4be2e4bfa10b3086f24c">get_ilite</a>() )};</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>(</div>
<div class="line">        g_trx, <span class="stringliteral">&quot;neutron_yields&quot;</span>, <span class="stringliteral">&quot;#/s&quot;</span>, 1, dims_n, &amp;trx.<a name="a18"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#a27a6d16cc479bd4278f6e8fbe1faf71f">get_genneu</a>()-&gt;at( 0 ) );</div>
<div class="line">    <span class="comment">// kappa capture</span></div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_trx,</div>
<div class="line">                                <span class="stringliteral">&quot;kappa_capture&quot;</span>,</div>
<div class="line">                                <span class="stringliteral">&quot;MeV&quot;</span>,</div>
<div class="line">                                1,</div>
<div class="line">                                dims_nd,</div>
<div class="line">                                &amp;trx.<a name="a19"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#a5b1ba5584db0db587c26bc256a9bcaf0">get_kappa_capture</a>()-&gt;at( 0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// kappa fission</span></div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_trx,</div>
<div class="line">                                <span class="stringliteral">&quot;kappa_fission&quot;</span>,</div>
<div class="line">                                <span class="stringliteral">&quot;MeV&quot;</span>,</div>
<div class="line">                                1,</div>
<div class="line">                                dims_fisxs,</div>
<div class="line">                                &amp;trx.<a name="a20"></a><a class="code" href="../../d7/d41/class_origen_1_1_transition_matrix_p.html#aa18c2e884aca23df3eabb680d664580c">get_kappa_fission</a>()-&gt;at( 0 ) );</div>
<div class="line"></div>
<div class="line">    (void)status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> g_trx;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">hid_t <a name="a21"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a01522ea5cf369bcb5179fa8627f5b1fc">h5_write_step</a>( <span class="keyword">const</span> <a name="_a22"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html">Origen::Material</a>&amp; mat, <span class="keywordtype">int</span> p, hid_t g_mat )</div>
<div class="line">{</div>
<div class="line">    jDebugLine( <span class="stringliteral">&quot;   write_step&quot;</span> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// convenience</span></div>
<div class="line">    hsize_t dims_nd[] = {mat.<a name="a23"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a9f78d67a34395eea0b650fd5714a89f7">total_nuclides</a>()};</div>
<div class="line">    hsize_t dims[] = {1};</div>
<div class="line">    herr_t status;</div>
<div class="line">    std::string s;</div>
<div class="line">    <span class="keywordtype">double</span> d;</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        std::stringstream ss;</div>
<div class="line">        ss &lt;&lt; <span class="stringliteral">&quot;Step(&quot;</span> &lt;&lt; ( p + 1 ) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">        s = ss.str();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    hid_t g_step = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#ab63cc3f19b86fa104f313ea75abb00db">h5_group_handle</a>( g_mat, s.c_str() );</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;g_step=&quot;</span> &lt;&lt; g_step &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// write amount at begin-of-step</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#abf0a77d8892af68cbca20f3a4513fd75">Origen::SP_DoubleList</a> vec = mat.<a name="a24"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a9f5e682d981dbd194752cd80e6c89bc4">amount_at</a>( p );</div>
<div class="line"></div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>(</div>
<div class="line">        g_step, <span class="stringliteral">&quot;bos_amount&quot;</span>, <span class="stringliteral">&quot;#-cm2/barn&quot;</span>, 1, dims_nd, &amp;( *vec )[0] );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( p &gt;= mat.<a name="a25"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a60f8f1b2a0d0cb9fb2564bd14572455a">nsteps</a>() )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> g_step;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// time at begin-of-step</span></div>
<div class="line">    d = mat.<a name="a26"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#ab7e8b5bc7ff3257cea1febebebecf62e">time_at</a>( p );</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_step, <span class="stringliteral">&quot;time_bos&quot;</span>, <span class="stringliteral">&quot;s&quot;</span>, 1, dims, &amp;d );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// flux over the step</span></div>
<div class="line">    d = mat.<a name="a27"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a8ac62e927aa0014691fa9f13c35284eb">flux_over</a>( p );</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_step, <span class="stringliteral">&quot;step_flux&quot;</span>, <span class="stringliteral">&quot;#/cm2-s&quot;</span>, 1, dims, &amp;d );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// power over the step</span></div>
<div class="line">    d = mat.<a name="a28"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a03348ccf0d20c77218d445be29686e44">power_over</a>( p );</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_step, <span class="stringliteral">&quot;step_power&quot;</span>, <span class="stringliteral">&quot;W&quot;</span>, 1, dims, &amp;d );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// get transition matrix</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a7a406c531668ac8d63ce2e70eb1b38f4">Origen::SP_TransitionMatrixP</a> trx = mat.<a name="a29"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#adfd88ac030039efa2618e01aa706795e">transition_matrix_over</a>( p );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// write transition matrix</span></div>
<div class="line">    hid_t g_trx = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a20fe7eeaf1b511281de0e3433bf94fb0">h5_write_trx</a>( *trx, g_step );</div>
<div class="line">    status = H5Gclose( g_trx );</div>
<div class="line"></div>
<div class="line">    (void)status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> g_step;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">hid_t <a name="a30"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a66927a99e8d41f67daebed751786534a">h5_write_material</a>( <span class="keyword">const</span> <a class="code" href="../../df/d34/class_origen_1_1_material.html">Origen::Material</a>&amp; mat, hid_t g_reg )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// convenience</span></div>
<div class="line">    herr_t status;</div>
<div class="line">    std::string s;</div>
<div class="line">    <span class="keywordtype">double</span> d;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// scalar dims</span></div>
<div class="line">    hsize_t dims[1] = {1};</div>
<div class="line"></div>
<div class="line">    <span class="comment">// material group</span></div>
<div class="line">    {</div>
<div class="line">        std::stringstream ss;</div>
<div class="line">        ss &lt;&lt; <span class="stringliteral">&quot;Material(&quot;</span> &lt;&lt; mat.<a name="a31"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#ae0c063cfb2479f614be43b9d2f92ba63">id</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">        s = ss.str();</div>
<div class="line">    }</div>
<div class="line">    hid_t g_mat = H5Gcreate1( g_reg, s.c_str(), 0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// library type</span></div>
<div class="line">    s = mat.<a name="a32"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a46e42023ee0cbc593b0bbbe03bdfaca2">library_type</a>();</div>
<div class="line">    status = H5LTmake_dataset_string( g_mat, <span class="stringliteral">&quot;library_type&quot;</span>, s.c_str() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// initial mass</span></div>
<div class="line">    d = mat.<a name="a33"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a7280c744f5ba9d41356836b1f1baf63a">initial_mass</a>();</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_mat, <span class="stringliteral">&quot;initial_mass&quot;</span>, <span class="stringliteral">&quot;g&quot;</span>, 1, dims, &amp;d );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// initial heavy metal mass</span></div>
<div class="line">    d = mat.<a name="a34"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a8a5f792e0b089585bd71f8b8822695da">initial_hm_mass</a>();</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_mat, <span class="stringliteral">&quot;initial_hm_mass&quot;</span>, <span class="stringliteral">&quot;g&quot;</span>, 1, dims, &amp;d );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// material name</span></div>
<div class="line">    s = mat.<a name="a35"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a37627d5d5bba7f4a8690c71c2ab3cb07">name</a>();</div>
<div class="line">    status = H5LTmake_dataset_string( g_mat, <span class="stringliteral">&quot;name&quot;</span>, s.c_str() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// material id</span></div>
<div class="line">    i = mat.<a class="code" href="../../df/d34/class_origen_1_1_material.html#ae0c063cfb2479f614be43b9d2f92ba63">id</a>();</div>
<div class="line">    status = H5LTmake_dataset_int( g_mat, <span class="stringliteral">&quot;id&quot;</span>, 1, dims, &amp;i );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// cold volume</span></div>
<div class="line">    d = mat.<a name="a36"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#afe473feb8ddf9d19a21e43141c70c367">cold_volume</a>();</div>
<div class="line">    status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_mat, <span class="stringliteral">&quot;cold_volume&quot;</span>, <span class="stringliteral">&quot;cm3&quot;</span>, 1, dims, &amp;d );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// just make a group for each point</span></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> p = 0; p &lt; mat.<a name="a37"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a48d58e8a1baca4c1351488c9856320f6">ntimes</a>(); ++p )</div>
<div class="line">    {</div>
<div class="line">        hid_t g_step = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a01522ea5cf369bcb5179fa8627f5b1fc">h5_write_step</a>( mat, p, g_mat );</div>
<div class="line">        status = H5Gclose( g_step );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    (void)status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> g_mat;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">hid_t <a name="a38"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a3dab9c39e7ce893d07b05f4bb8d8088b">h5_write_materialmap_registry</a>( <span class="keyword">const</span> <a name="_a39"></a><a class="code" href="../../d2/d86/class_origen_1_1_material_map.html">Origen::MaterialMap</a>&amp; mat_map,</div>
<div class="line">                                     hid_t file )</div>
<div class="line">{</div>
<div class="line">    herr_t status;</div>
<div class="line">    hid_t g_matreg = H5Gcreate1( file, <span class="stringliteral">&quot;MaterialMap&quot;</span>, 0 );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keyword">auto</span> it = mat_map.begin(); it != mat_map.end(); ++it )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="../../d5/dc1/namespace_origen.html#a55c03e9e8d89fdf39a370e8e83220fec">Origen::SP_Material</a>&amp; mat = it-&gt;second;</div>
<div class="line">        hid_t g_mat = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a66927a99e8d41f67daebed751786534a">h5_write_material</a>( *mat, g_matreg );</div>
<div class="line">        status = H5Gclose( g_mat );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    (void)status;</div>
<div class="line">    <span class="keywordflow">return</span> g_matreg;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">hid_t <a name="a40"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a4ff9a94f2f5dcb3ccb9e485439b17a64">h5_write_library_registry</a>( <span class="keyword">const</span> <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a90762cbc8b668e34f864aed04d71115e">LibraryMap_t</a>&amp; lib_map, hid_t file )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// convenience</span></div>
<div class="line">    herr_t status;</div>
<div class="line">    <span class="comment">// int i;</span></div>
<div class="line">    std::string s;</div>
<div class="line">    <span class="comment">// hsize_t dims[]={1};</span></div>
<div class="line"></div>
<div class="line">    hid_t g_libreg = H5Gcreate1( file, <span class="stringliteral">&quot;LibraryMap&quot;</span>, 0 );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keyword">auto</span> it = lib_map.begin(); it != lib_map.end(); ++it )</div>
<div class="line">    {</div>
<div class="line">        {</div>
<div class="line">            std::stringstream ss;</div>
<div class="line">            ss &lt;&lt; <span class="stringliteral">&quot;Library(&quot;</span> &lt;&lt; it-&gt;first &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">            s = ss.str();</div>
<div class="line">        }</div>
<div class="line">        hid_t g_lib = H5Gcreate1( g_libreg, s.c_str(), 0 );</div>
<div class="line"></div>
<div class="line">        <a class="code" href="../../d5/dc1/namespace_origen.html#aa3ba24879f383fe079561477ccb875cb">Origen::SP_Library</a> lib = it-&gt;second;</div>
<div class="line">        hsize_t dims_nd[] = {(hsize_t)lib-&gt;definition().total_nuclides()};</div>
<div class="line"></div>
<div class="line">        <span class="comment">// decay constants</span></div>
<div class="line">        status = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#af817c25cd33409e020b3ac7eb532fb9f">h5_update_dataset</a>( g_lib,</div>
<div class="line">                                    <span class="stringliteral">&quot;decay_constants&quot;</span>,</div>
<div class="line">                                    <span class="stringliteral">&quot;1/s&quot;</span>,</div>
<div class="line">                                    1,</div>
<div class="line">                                    dims_nd,</div>
<div class="line">                                    &amp;lib-&gt;decay_data().decay_constants[0] );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ids</span></div>
<div class="line">        status = H5LTmake_dataset_int(</div>
<div class="line">            g_lib,</div>
<div class="line">            <span class="stringliteral">&quot;sizzzaaa_list&quot;</span>,</div>
<div class="line">            1,</div>
<div class="line">            dims_nd,</div>
<div class="line">            &amp;lib-&gt;definition().nuclide_set().ids().at( 0 ) );</div>
<div class="line">        <span class="comment">// group structure</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// fissionable nuclides</span></div>
<div class="line">        <a class="code" href="../../d7/d09/group___cxx_typedefs.html#ga976f74e647ebeda64bcacc193529ec38">Origen::SP_Vec_Int</a> fiss = lib-&gt;decay_data().fissionables();</div>
<div class="line">        hsize_t dims_f[] = {(hsize_t)fiss-&gt;size()};</div>
<div class="line">        status = H5LTmake_dataset_int(</div>
<div class="line">            g_lib, <span class="stringliteral">&quot;fissionables&quot;</span>, 1, dims_f, &amp;fiss-&gt;at( 0 ) );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// locations</span></div>
<div class="line">        <span class="keyword">const</span> <a name="_a41"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html">Origen::TransitionStructure</a> ts = lib-&gt;transition_structure();</div>
<div class="line">        status = H5LTmake_dataset_int(</div>
<div class="line">            g_lib, <span class="stringliteral">&quot;num_parents&quot;</span>, 1, dims_nd, &amp;ts.num_parents().at( 0 ) );</div>
<div class="line">        status = H5LTmake_dataset_int( g_lib,</div>
<div class="line">                                       <span class="stringliteral">&quot;num_decay_parents&quot;</span>,</div>
<div class="line">                                       1,</div>
<div class="line">                                       dims_nd,</div>
<div class="line">                                       &amp;ts.num_decay_parents().at( 0 ) );</div>
<div class="line"></div>
<div class="line">        hsize_t dims_t[] = {(hsize_t)ts.<a name="a42"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#a46a8f5ebc272d002f4feb1bc048503ce">parent_positions_size</a>()};</div>
<div class="line">        status = H5LTmake_dataset_int( g_lib,</div>
<div class="line">                                       <span class="stringliteral">&quot;parent_positions&quot;</span>,</div>
<div class="line">                                       1,</div>
<div class="line">                                       dims_t,</div>
<div class="line">                                       &amp;ts.parent_positions().at( 0 ) );</div>
<div class="line">        status = H5LTmake_dataset_int(</div>
<div class="line">            g_lib, <span class="stringliteral">&quot;transition_ids&quot;</span>, 1, dims_t, &amp;ts.transition_ids().at( 0 ) );</div>
<div class="line">    }</div>
<div class="line">    (void)status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> g_libreg;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="a43"></a><a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a8b1d55ab032473483af51878fa27e812">TEST</a>( MaterialBuffer, hdf5 )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// library</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#aa3ba24879f383fe079561477ccb875cb">Origen::SP_Library</a> lib = <a name="a44"></a><a class="code" href="../../d5/dc1/namespace_origen.html#aa3ba24879f383fe079561477ccb875cb">Origen::SP_Library</a>( <span class="keyword">new</span> <a name="_a45"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a>() );</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">bool</span> pass = <a name="a46"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#aeeab0b5173c8f0f318815516c66f96d1">Origen::FakeFactory::Library_scale_pwr</a>( *lib );</div>
<div class="line">        ASSERT_TRUE( pass );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// initialize</span></div>
<div class="line">    <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 1;</div>
<div class="line">    <span class="keywordtype">double</span> vol = 1.2;</div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a55c03e9e8d89fdf39a370e8e83220fec">Origen::SP_Material</a> mat(</div>
<div class="line">        <span class="keyword">new</span> <a class="code" href="../../df/d34/class_origen_1_1_material.html">Origen::Material</a>( <span class="stringliteral">&quot;GENERAL&quot;</span>, lib, <span class="stringliteral">&quot;mix001&quot;</span>, <span class="keywordtype">id</span>, vol ) );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gae386eb6c70779056cf6d5c6d1c43c48f">Origen::Vec_Int</a> ref_ids;</div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Origen::Vec_Dbl</a> ref_vals;</div>
<div class="line">    <a name="a47"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#a32955ef2509f74b312d8b7b3110c16a8">Origen::FakeFactory::vera_uox_e360</a>( ref_ids, ref_vals );</div>
<div class="line">    mat-&gt;<a name="a48"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#aa08562727b473f6c74ef84894eff4040">set_numden_bos</a>( ref_vals, ref_ids );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add the material map</span></div>
<div class="line">    <a class="code" href="../../d2/d86/class_origen_1_1_material_map.html">Origen::MaterialMap</a> mat_map;</div>
<div class="line">    mat_map[id] = mat;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// transition matrix</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a7a406c531668ac8d63ce2e70eb1b38f4">Origen::SP_TransitionMatrixP</a> trx_m1 =</div>
<div class="line">        mat-&gt;<a name="a49"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#ac95b2f770966959fbe0cd46d1ee78cf6">library</a>()-&gt;newsp_transition_matrix_at( 0 );</div>
<div class="line">    <span class="keywordtype">double</span> flux_m1 = 3.91;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add a step</span></div>
<div class="line">    mat-&gt;<a name="a50"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a9a32702e796b20e9c67d247267b8c38a">add_step</a>( 123.456 );  <span class="comment">// step 0</span></div>
<div class="line">    mat-&gt;<a name="a51"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a73f6b4b0c94c3fb475ecf64379f99f6a">set_flux</a>( flux_m1 );</div>
<div class="line">    mat-&gt;<a name="a52"></a><a class="code" href="../../df/d34/class_origen_1_1_material.html#a9b66000066bc908fe821f1a227a4d823">set_transition_matrix</a>( trx_m1 );</div>
<div class="line"></div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a9a32702e796b20e9c67d247267b8c38a">add_step</a>( 223.456 );  <span class="comment">// step 1</span></div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a73f6b4b0c94c3fb475ecf64379f99f6a">set_flux</a>( flux_m1 );</div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a9b66000066bc908fe821f1a227a4d823">set_transition_matrix</a>( trx_m1 );</div>
<div class="line"></div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a9a32702e796b20e9c67d247267b8c38a">add_step</a>( 323.456 );  <span class="comment">// step 2</span></div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a73f6b4b0c94c3fb475ecf64379f99f6a">set_flux</a>( flux_m1 );</div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a9b66000066bc908fe821f1a227a4d823">set_transition_matrix</a>( trx_m1 );</div>
<div class="line"></div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a9a32702e796b20e9c67d247267b8c38a">add_step</a>( 423.456 );  <span class="comment">// step 3</span></div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a73f6b4b0c94c3fb475ecf64379f99f6a">set_flux</a>( flux_m1 );</div>
<div class="line">    mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#a9b66000066bc908fe821f1a227a4d823">set_transition_matrix</a>( trx_m1 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// collect the library map</span></div>
<div class="line">    <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a90762cbc8b668e34f864aed04d71115e">LibraryMap_t</a> lib_map;</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keyword">auto</span> it = mat_map.begin(); it != mat_map.end(); ++it )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="../../d5/dc1/namespace_origen.html#a55c03e9e8d89fdf39a370e8e83220fec">Origen::SP_Material</a>&amp; mat = it-&gt;second;</div>
<div class="line">        lib_map[mat-&gt;library_type()] = mat-&gt;<a class="code" href="../../df/d34/class_origen_1_1_material.html#ac95b2f770966959fbe0cd46d1ee78cf6">library</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    herr_t status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Create a new file using the default properties.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    hid_t file = H5Fcreate( <span class="stringliteral">&quot;a.h5&quot;</span>, H5F_ACC_TRUNC, H5P_DEFAULT, H5P_DEFAULT );</div>
<div class="line">    {</div>
<div class="line">        hid_t g_matreg = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a3dab9c39e7ce893d07b05f4bb8d8088b">h5_write_materialmap_registry</a>( mat_map, file );</div>
<div class="line">        status = H5Gclose( g_matreg );</div>
<div class="line"></div>
<div class="line">        hid_t g_libreg = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a4ff9a94f2f5dcb3ccb9e485439b17a64">h5_write_library_registry</a>( lib_map, file );</div>
<div class="line">        status = H5Gclose( g_libreg );</div>
<div class="line">    }</div>
<div class="line">    status = H5Fclose( file );</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Add a new data point to the file</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    mat-&gt;add_step( 523.456 );  <span class="comment">// step 4</span></div>
<div class="line">    mat-&gt;set_flux( flux_m1 );</div>
<div class="line">    mat-&gt;set_transition_matrix( trx_m1 );</div>
<div class="line">    hid_t ofile = H5Fopen( <span class="stringliteral">&quot;a.h5&quot;</span>, H5F_ACC_RDWR, H5P_DEFAULT );</div>
<div class="line">    {</div>
<div class="line">        std::string s;</div>
<div class="line">        {</div>
<div class="line">            std::stringstream ss;</div>
<div class="line">            ss &lt;&lt; <span class="stringliteral">&quot;/MaterialMap/Material(&quot;</span> &lt;&lt; mat-&gt;id() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">            s = ss.str();</div>
<div class="line">        }</div>
<div class="line">        hid_t g_mat = H5Gopen1( ofile, s.c_str() );</div>
<div class="line">        hid_t g_step = <a class="code" href="../../db/d51/tst_material_buffer_8cpp.html#a01522ea5cf369bcb5179fa8627f5b1fc">h5_write_step</a>( *mat, 4, g_mat );</div>
<div class="line">        status = H5Gclose( g_step );</div>
<div class="line">        status = H5Gclose( g_mat );</div>
<div class="line">    }</div>
<div class="line">    status = H5Fclose( ofile );</div>
<div class="line"></div>
<div class="line">    (void)status;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
