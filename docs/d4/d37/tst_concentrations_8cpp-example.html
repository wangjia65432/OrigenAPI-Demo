<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.10"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>ORIGEN API: tstConcentrations.cpp</title>
        <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="../../dynsections.js"></script>
        <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
        <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
        <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">ORIGEN API v0.5.2</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Overview</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../modules.html"><span>Components</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../d1/d5b/md__c_h_a_n_g_e_l_o_g.html"><span>Changelog</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tstConcentrations.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>./Core/dc/tests/tstConcentrations.cpp</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Nemesis/gtest/nemesis_gtest.hh&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Origen/Core/config.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d3/dd9/_concentrations_8h.html">Origen/Core/dc/Concentrations.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d3/ddd/_fake_factory_8h.html">Origen/Core/dc/FakeFactory.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../df/d09/default_nuclide_resource_8h.html">Origen/Core/re/defaultNuclideResource.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Standard/Interface/SerialStream.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> std::vector;</div>
<div class="line"><span class="keyword">using</span> std::pair;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="../../d5/dc1/namespace_origen.html">Origen</a>;</div>
<div class="line"></div>
<div class="line"><a name="a0"></a><a class="code" href="../../d0/de8/tst_concentrations_8cpp.html#ac6e0825f3a0ed085c3d0d2f8eb99be52">TEST</a>( tstConcentrations, Basic )</div>
<div class="line">{</div>
<div class="line">    <a name="_a1"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> concs;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set 3 nuclides in 3 different sublibs and use internal sorting option</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">bool</span> sort = <span class="keyword">true</span>;</div>
<div class="line">        <a name="_a2"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> nuc_set( {10001001, 30002002, 20002002}, sort );</div>
<div class="line">        concs.<a name="a3"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ac106f978716fdd0ff70e88741e894ccd">set_nuclide_set</a>( nuc_set );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// get the nuclide set and check that ids were reordered correctly</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a>&amp; nuc_set = concs.<a name="a4"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>();</div>
<div class="line">    EXPECT_VEC_EQ( <a name="a5"></a><a class="code" href="../../d7/d09/group___cxx_typedefs.html#gae386eb6c70779056cf6d5c6d1c43c48f">Vec_Int</a>( {10001001, 20002002, 30002002} ), nuc_set.<a name="a6"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a889dc0300ad2c9cc1f40884d2e61ac25">ids</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set values that correspond to the actual order</span></div>
<div class="line">    concs.<a name="a7"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a45e7f26f3b785cf397a6ecd3e4640bec">set_vals</a>( {1.0, 0.5, 0.25} );</div>
<div class="line">    EXPECT_VEC_EQ( <a name="a8"></a><a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Vec_Dbl</a>( {1.0, 0.5, 0.25} ), concs.<a name="a9"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a33ef586db314dbe5cac7700013d13157">vals</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check vals_at</span></div>
<div class="line">    EXPECT_EQ( 1.00, concs.<a name="a10"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 0 ) );</div>
<div class="line">    EXPECT_EQ( 0.50, concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 1 ) );</div>
<div class="line">    EXPECT_EQ( 0.25, concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 2 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// new concentrations from copy</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> concs2( concs );</div>
<div class="line">    EXPECT_TRUE( concs.<a name="a11"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a4f7af621f5bc11580263728832530282">match</a>( concs2 ) );</div>
<div class="line">    EXPECT_EQ( concs, concs2 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// make sure still matches but values are new</span></div>
<div class="line">    concs2.set_vals( 0.0 );</div>
<div class="line">    EXPECT_VEC_EQ( <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Vec_Dbl</a>( {0.0, 0.0, 0.0} ), concs2.vals() );</div>
<div class="line">    EXPECT_TRUE( concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a4f7af621f5bc11580263728832530282">match</a>( concs2 ) );</div>
<div class="line">    EXPECT_FALSE( concs == concs2 );</div>
<div class="line">    EXPECT_VEC_EQ( <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Vec_Dbl</a>( {1.0, 0.5, 0.25} ), concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a33ef586db314dbe5cac7700013d13157">vals</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// attempt to add a nuclide that we should find</span></div>
<div class="line">    <span class="keywordtype">bool</span> all_found;</div>
<div class="line">    all_found = concs.<a name="a12"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a8837765f48e45c30739d15657a5c531a">accumulate_concs</a>( {30002002}, {5.3} );</div>
<div class="line">    EXPECT_TRUE( all_found );</div>
<div class="line">    EXPECT_FLOAT_EQ( 5.3 + 0.25, concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 2 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// attempt to add two where one is found and one not</span></div>
<div class="line">    all_found = concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a8837765f48e45c30739d15657a5c531a">accumulate_concs</a>( {30002002, 30003003}, {2.1, 2.1} );</div>
<div class="line">    EXPECT_FALSE( all_found );</div>
<div class="line">    EXPECT_FLOAT_EQ( 5.3 + 0.25 + 2.1, concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 2 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// attempt to add without sublib and should find match for 30002002</span></div>
<div class="line">    <span class="comment">// and not 20002002</span></div>
<div class="line">    <span class="keywordtype">double</span> prev = concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 1 );</div>
<div class="line">    all_found = concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a8837765f48e45c30739d15657a5c531a">accumulate_concs</a>( {2002}, {1.6} );</div>
<div class="line">    EXPECT_TRUE( all_found );</div>
<div class="line">    EXPECT_FLOAT_EQ( 5.3 + 0.25 + 2.1 + 1.6, concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 2 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( prev, concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 1 ) );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d0/de8/tst_concentrations_8cpp.html#ac6e0825f3a0ed085c3d0d2f8eb99be52">TEST</a>( tstConcentrations, NuclideSetManagement )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// many variants of a nuclide like depletion would have</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> depl;</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> nuc_set;</div>
<div class="line">        nuc_set.<a name="a13"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#ad1596b8009f8903a70ac90a9059031f3">set_ids</a>(</div>
<div class="line">            {10001003, 10027058, 20001003, 30001002, 30027058, 40001003} );</div>
<div class="line">        depl.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ac106f978716fdd0ff70e88741e894ccd">set_nuclide_set</a>( nuc_set );</div>
<div class="line">    }</div>
<div class="line">    depl.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a45e7f26f3b785cf397a6ecd3e4640bec">set_vals</a>( 1.0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// single variant of a nuclide like transport would have</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> tran;</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> nuc_set;</div>
<div class="line">        nuc_set.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#ad1596b8009f8903a70ac90a9059031f3">set_ids</a>( {1003, 27058} );</div>
<div class="line">        tran.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ac106f978716fdd0ff70e88741e894ccd">set_nuclide_set</a>( nuc_set );</div>
<div class="line">    }</div>
<div class="line">    tran.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a45e7f26f3b785cf397a6ecd3e4640bec">set_vals</a>( 0.5 );</div>
<div class="line">    EXPECT_FALSE( tran.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>().<a name="a14"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#acaa2e302fc58ed7a4c570af900345ada">has_sublibs</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> found;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Setting the izzzaaa onto a Concentrations with sizzzaaa,</span></div>
<div class="line">    found = depl.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a8837765f48e45c30739d15657a5c531a">accumulate_concs</a>( {1003, 27058}, {0.5, 1.2} );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// find in SUBLIB_1LT because Z&lt;26</span></div>
<div class="line">    EXPECT_EQ( 10001003, depl.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>().<a name="a15"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#af65c9c915f254006705af86d2d9c8ddd">ids_at</a>( 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 1.5, depl.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 1.5, depl.<a name="a16"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a0f4b9b16a4cdb76944d6b1175f25735f">lookup_val</a>( 10001003 ) );</div>
<div class="line">    <span class="comment">// find ins SUBLIB_3FP because first moving backwards</span></div>
<div class="line">    EXPECT_EQ( 30027058, depl.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>().<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#af65c9c915f254006705af86d2d9c8ddd">ids_at</a>( 4 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 2.2, depl.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 4 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 2.2, depl.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a0f4b9b16a4cdb76944d6b1175f25735f">lookup_val</a>( 30027058 ) );</div>
<div class="line">    EXPECT_TRUE( found );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Tricky part is getting the transport set with izzzaaa to update</span></div>
<div class="line">    <span class="comment">// from the depletion set with sizzzaaa.</span></div>
<div class="line">    found = tran.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a8837765f48e45c30739d15657a5c531a">accumulate_concs</a>(</div>
<div class="line">        {10001003, 10027058, 20001003, 30001002, 30027058, 40001003},</div>
<div class="line">        {0.1, 0.2, 0.3, 0.4, 0.5, 0.6} );</div>
<div class="line"></div>
<div class="line">    EXPECT_TRUE( found );</div>
<div class="line">    EXPECT_FLOAT_EQ( 0.1 + 0.3 + 0.6 + 0.5, tran.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a0f4b9b16a4cdb76944d6b1175f25735f">lookup_val</a>( 1003 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 0.2 + 0.5 + 0.5, tran.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a0f4b9b16a4cdb76944d6b1175f25735f">lookup_val</a>( 27058 ) );</div>
<div class="line">    EXPECT_EQ( <a name="a17"></a><a class="code" href="../../da/d97/group___cxx_constants.html#ga3083f3df34689c1aa3f0f0107c6f70f5">BAD_DOUBLE</a>, tran.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a0f4b9b16a4cdb76944d6b1175f25735f">lookup_val</a>( 1002 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 0, tran.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a0f4b9b16a4cdb76944d6b1175f25735f">lookup_val</a>( 1002, 0.0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// std::cout &lt;&lt; depl.to_string() &lt;&lt; std::endl;</span></div>
<div class="line">    <span class="comment">// std::cout &lt;&lt; tran.to_string() &lt;&lt; std::endl;</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d0/de8/tst_concentrations_8cpp.html#ac6e0825f3a0ed085c3d0d2f8eb99be52">TEST</a>( tstConcentrations, Serialization1 )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// many variants of a nuclide like depletion would have</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> obj1;</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> nuc_set;</div>
<div class="line">        nuc_set.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#ad1596b8009f8903a70ac90a9059031f3">set_ids</a>( {10001003, 20001003, 30001002, 40001003} );</div>
<div class="line">        obj1.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ac106f978716fdd0ff70e88741e894ccd">set_nuclide_set</a>( nuc_set );</div>
<div class="line">    }</div>
<div class="line">    obj1.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a45e7f26f3b785cf397a6ecd3e4640bec">set_vals</a>( 1.0 );</div>
<div class="line">    obj1.<a name="a18"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a0fefd52ed9e48f7b500a5489a5aa7ee5">set_volume</a>( 3.0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// serialize</span></div>
<div class="line">    SerialStream ss;</div>
<div class="line">    <span class="keywordtype">int</span> return_code = obj1.<a name="a19"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ae4c23583af6639cd829b18fac3280e24">serialize</a>( &amp;ss );</div>
<div class="line">    EXPECT_EQ( 0, return_code );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// deserialize</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> obj2;</div>
<div class="line">    return_code = obj2.<a name="a20"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ad6fdab80f4d25ff470dc98ec59635e5c">deserialize</a>( &amp;ss );</div>
<div class="line">    EXPECT_EQ( 0, return_code );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// compare</span></div>
<div class="line">    EXPECT_EQ( obj1, obj2 );</div>
<div class="line">    EXPECT_NE( &amp;obj1, &amp;obj2 );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d0/de8/tst_concentrations_8cpp.html#ac6e0825f3a0ed085c3d0d2f8eb99be52">TEST</a>( tstConcentrations, Serialization2 )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// create a nuclide set</span></div>
<div class="line">    <a class="code" href="../../d4/d05/namespace_vec___int.html">Vec_Int</a> ids;</div>
<div class="line">    <a name="a21"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#a3f5074a0309e7a45d83499d01b910c6e">FakeFactory::nuclide_set_addnux4</a>( ids );</div>
<div class="line">    <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> nuc_set;</div>
<div class="line">    nuc_set.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#ad1596b8009f8903a70ac90a9059031f3">set_ids</a>( ids );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// re-use buffer to get numden</span></div>
<div class="line">    <a class="code" href="../../d7/d09/group___cxx_typedefs.html#gab1ba8712f15aa615abd0cbc3cc58112f">Vec_Dbl</a> numden;</div>
<div class="line">    <a name="a22"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#a5fa02c958ecadf3f3af37f72706cf700">FakeFactory::vera_uox_e310</a>( ids, numden );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set up concentrations</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> obj1;</div>
<div class="line">    obj1.<a name="a23"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a3680d6a9dfba0e096906180b18a97155">set_units</a>( <a name="a24"></a><a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880dae91739cb6b73294f95c000bd050a2873">ATOMS_B_CM</a> );</div>
<div class="line">    obj1.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ac106f978716fdd0ff70e88741e894ccd">set_nuclide_set</a>( nuc_set );</div>
<div class="line">    obj1.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a0fefd52ed9e48f7b500a5489a5aa7ee5">set_volume</a>( 3.0 );</div>
<div class="line">    obj1.<a name="a25"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a371782e2ae025b5502a49a8653fda9bd">set_concs</a>( ids, numden );</div>
<div class="line">    <span class="comment">// std::cout &lt;&lt; obj1.to_string() &lt;&lt; std::endl;</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// serialize</span></div>
<div class="line">    SerialStream ss;</div>
<div class="line">    <span class="keywordtype">int</span> return_code = obj1.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ae4c23583af6639cd829b18fac3280e24">serialize</a>( &amp;ss );</div>
<div class="line">    EXPECT_EQ( 0, return_code );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// deserialize</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> obj2;</div>
<div class="line">    return_code = obj2.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ad6fdab80f4d25ff470dc98ec59635e5c">deserialize</a>( &amp;ss );</div>
<div class="line">    EXPECT_EQ( 0, return_code );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// compare</span></div>
<div class="line">    EXPECT_EQ( obj1, obj2 );</div>
<div class="line">    EXPECT_NE( &amp;obj1, &amp;obj2 );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d0/de8/tst_concentrations_8cpp.html#ac6e0825f3a0ed085c3d0d2f8eb99be52">TEST</a>( tstConcentrations, UnitConversion )</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> nr = std::make_shared&lt;NuclideResource&gt;();</div>
<div class="line">    <a name="a26"></a><a class="code" href="../../d5/dc1/namespace_origen.html#adb61847813ab464c57d90bffa87d9fbf">defaultNuclideResource</a>( &amp;*nr );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check that masses are close (but not quite) the mass number</span></div>
<div class="line">    <span class="keywordtype">double</span> u5 = nr-&gt;mass( 92235 );</div>
<div class="line">    EXPECT_EQ( 235, <span class="keywordtype">int</span>( u5 ) );</div>
<div class="line">    EXPECT_NE( 235.0, u5 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check that masses are close (but not quite) the mass number</span></div>
<div class="line">    <span class="keywordtype">double</span> u8 = nr-&gt;mass( 92238 );</div>
<div class="line">    EXPECT_EQ( 238, <span class="keywordtype">int</span>( u8 ) );</div>
<div class="line">    EXPECT_NE( 238.0, u8 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// get a library and extract the nuclide set</span></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#aa3ba24879f383fe079561477ccb875cb">SP_Library</a> lib = <a name="a27"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#a1b4d9f7a3dd266e50da323a90c16eb33">FakeFactory::newspLibrary_10nuclide</a>();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a>&amp; nuc_set = lib-&gt;definition().nuclide_set();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create Concentrations with the same nuclide set and nuclide resource</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> concs( nuc_set );</div>
<div class="line">    concs.set_nuclide_resource( nr );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// test out moles--&gt;grams first</span></div>
<div class="line">    concs.set_units( <a name="a28"></a><a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880da382b25822ec0fef9c7f866e40153e01e">MOLES</a> );</div>
<div class="line">    concs.set_concs( {92238, 92235}, {2.0, 1.0} );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// switch to grams, check values</span></div>
<div class="line">    concs.set_units( <a name="a29"></a><a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880da73a9747a2e1ccab011a3bc941d495c2f">GRAMS</a> );</div>
<div class="line">    EXPECT_FLOAT_EQ( 2.0 * u8, concs.lookup_val( 20092238 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 1.0 * u5, concs.lookup_val( 20092235 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// spot check other values are zero</span></div>
<div class="line">    EXPECT_EQ( 0.0, concs.vals_at( 0 ) );</div>
<div class="line">    EXPECT_EQ( 0.0, concs.vals_at( 9 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// normalize to 1 (wt frac)</span></div>
<div class="line">    <span class="keywordtype">size_t</span> iu5 = concs.nuclide_set().lookup_index_guess( 20092235 );</div>
<div class="line">    <span class="keyword">auto</span> x1 = concs.scp_vals();</div>
<div class="line">    concs.normalize();</div>
<div class="line">    <span class="keyword">auto</span> x2 = concs.scp_vals();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// make sure x1 still has old values</span></div>
<div class="line">    EXPECT_EQ( 1.0 * u5, x1-&gt;at( iu5 ) );</div>
<div class="line">    <span class="comment">// x2 has new values</span></div>
<div class="line">    EXPECT_GT( 1.0, x2-&gt;at( iu5 ) );</div>
<div class="line">    <span class="comment">// output at any time to check contents</span></div>
<div class="line">    <span class="comment">//std::cout &lt;&lt; concs.to_string() &lt;&lt; std::endl;</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// test atoms/barn-cm  --&gt; wt frac</span></div>
<div class="line">    concs.set_units( <a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880dae91739cb6b73294f95c000bd050a2873">ATOMS_B_CM</a> );</div>
<div class="line">    concs.set_concs( {92238, 92235}, {2.0e-3, 1.0e-3} );</div>
<div class="line">    concs.set_units( <a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880da73a9747a2e1ccab011a3bc941d495c2f">GRAMS</a> );</div>
<div class="line">    concs.normalize();</div>
<div class="line">    <span class="keyword">auto</span> x3 = concs.scp_vals();</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; x3-&gt;size(); ++i )</div>
<div class="line">    {</div>
<div class="line">        EXPECT_FLOAT_EQ( ( *x2 )[i], ( *x3 )[i] );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// make sure we can go back to atoms/b-cm</span></div>
<div class="line">    concs.set_units( <a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880dae91739cb6b73294f95c000bd050a2873">ATOMS_B_CM</a> );</div>
<div class="line">    EXPECT_FLOAT_EQ( 1.0e-3, concs.lookup_val( 20092235 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 2.0e-3, concs.lookup_val( 20092238 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// output at any time to check contents</span></div>
<div class="line">    <span class="comment">// std::cout &lt;&lt; concs.to_string() &lt;&lt; std::endl;</span></div>
<div class="line">}</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">//! Here we test going from a</span></div>
<div class="line"><span class="comment"></span><a class="code" href="../../d0/de8/tst_concentrations_8cpp.html#ac6e0825f3a0ed085c3d0d2f8eb99be52">TEST</a>( Concentration, UnitConversion2 )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Get the default nuclide resource, based on the current version of</span></div>
<div class="line">    <span class="comment">// the InMemoryStdCompLib.</span></div>
<div class="line">    <span class="keyword">auto</span> nr = std::make_shared&lt;NuclideResource&gt;();</div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#adb61847813ab464c57d90bffa87d9fbf">defaultNuclideResource</a>( &amp;*nr );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create two Concentrations.  The origen_concs will contain concentrations</span></div>
<div class="line">    <span class="comment">// with a nuclide set that has sublibs, i.e. lite=1, actinide=2, fp=3, and</span></div>
<div class="line">    <span class="comment">// units of mass in grams.  The stdcomp_concs represent what you would</span></div>
<div class="line">    <span class="comment">// get out a SCALE number density calculation, number density by nuclide</span></div>
<div class="line">    <span class="comment">// without sublib.</span></div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> origen_concs;</div>
<div class="line">    origen_concs.<a name="a30"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ad3eb8f31a888b9aec622a72071e5b438">set_nuclide_resource</a>( nr );</div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> stdcomp_concs = origen_concs;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initialize stdcomp_concs with numden.  Note that stdcomps do not have</span></div>
<div class="line">    <span class="comment">// a sublib, it is just a IZA.</span></div>
<div class="line">    <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> stdcomp_nuc_set( {8016, 92235, 1092235, 92238, 60148} );</div>
<div class="line">    stdcomp_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ac106f978716fdd0ff70e88741e894ccd">set_nuclide_set</a>( stdcomp_nuc_set );</div>
<div class="line">    stdcomp_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a3680d6a9dfba0e096906180b18a97155">set_units</a>( <a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880dae91739cb6b73294f95c000bd050a2873">ATOMS_B_CM</a> );</div>
<div class="line">    stdcomp_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a45e7f26f3b785cf397a6ecd3e4640bec">set_vals</a>( {4.0e-3, 1.0e-3, 1.0e-8, 2.0e-3, 1.0e-11} );</div>
<div class="line">    <span class="comment">// std::cout &lt;&lt; stdcomp_concs.to_string() &lt;&lt; std::endl;</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Now, initialize origen_concs with traditional sublib-based nuclide set.</span></div>
<div class="line">    <span class="comment">// Note that we have placed two versions of 60148: one in the activation</span></div>
<div class="line">    <span class="comment">// product/lite sublib=1, and one in the fission product sublib=3.</span></div>
<div class="line">    <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> origen_nuc_set(</div>
<div class="line">        {10008016, 10060148, 21092235, 20092235, 20092238, 30060148} );</div>
<div class="line">    origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#ac106f978716fdd0ff70e88741e894ccd">set_nuclide_set</a>( origen_nuc_set );</div>
<div class="line">    origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a3680d6a9dfba0e096906180b18a97155">set_units</a>( <a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880dae91739cb6b73294f95c000bd050a2873">ATOMS_B_CM</a> );</div>
<div class="line">    <span class="keywordtype">bool</span> conserved = origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a371782e2ae025b5502a49a8653fda9bd">set_concs</a>( stdcomp_concs );</div>
<div class="line">    EXPECT_TRUE( conserved );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// std::cout &lt;&lt; origen_concs.to_string() &lt;&lt; std::endl;</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// first make sure we know where everything went</span></div>
<div class="line">    EXPECT_FLOAT_EQ( 4.0e-03, origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 0.0e+00, origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 1 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 1.0e-08, origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 2 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 1.0e-03, origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 3 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 2.0e-03, origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 4 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 1.0e-11, origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aa2e4ee5c5b98502d721489a1c529b5f5">vals_at</a>( 5 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Now change units to grams.</span></div>
<div class="line">    origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a3680d6a9dfba0e096906180b18a97155">set_units</a>( <a class="code" href="../../d5/dc1/namespace_origen.html#ae45c38d6dbf0590cf3956b85a97e880da73a9747a2e1ccab011a3bc941d495c2f">GRAMS</a> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Normalize to 1 gram so now have weight fraction.</span></div>
<div class="line">    origen_concs.<a name="a31"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a38a8925700a6350a19ee19c66fb28b91">normalize</a>();</div>
<div class="line">    EXPECT_FLOAT_EQ( 1.0, origen_concs.<a name="a32"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a84c49a592b084e92f182eac1e7574f45">sum</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Alternatively can normalize to an amount of heavy metal (1MTHM here).</span></div>
<div class="line">    origen_concs.<a name="a33"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#aed94fdd5ef2b0e69611bf24df8751121">normalize_hm</a>( 1e6 );</div>
<div class="line">    EXPECT_FLOAT_EQ( 1e6, origen_concs.<a name="a34"></a><a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a4cdba977856c3342812015db870ba18d">sum_hm</a>() );</div>
<div class="line">    EXPECT_LT( 1e6, origen_concs.<a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html#a84c49a592b084e92f182eac1e7574f45">sum</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// std::cout &lt;&lt; origen_concs.to_string() &lt;&lt; std::endl;</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d0/de8/tst_concentrations_8cpp.html#ac6e0825f3a0ed085c3d0d2f8eb99be52">TEST</a>( tstConcentrations, accumulate )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// these could be any 3 numbers</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> a( 1.0 );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> b( 2.0 );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> c( 3.0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check we can accumulate on two nuclides</span></div>
<div class="line">    <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> nuc_set1( {1001, 1002} );</div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> conc1( nuc_set1 );</div>
<div class="line">    conc1.accumulate( {a, b} );</div>
<div class="line">    EXPECT_FLOAT_EQ( a, conc1.lookup_val( 1001, 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( b, conc1.lookup_val( 1002, 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( 0, conc1.lookup_val( 1003, 0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check that we can accumulate on three nuclides</span></div>
<div class="line">    <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">NuclideSet</a> nuc_set2( {1001, 1002, 1003} );</div>
<div class="line">    <a class="code" href="../../d7/d44/class_origen_1_1_concentrations.html">Concentrations</a> conc2( nuc_set2 );</div>
<div class="line">    conc2.accumulate( {0, c, c} );</div>
<div class="line">    EXPECT_FLOAT_EQ( 0, conc2.lookup_val( 1001, 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( c, conc2.lookup_val( 1002, 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( c, conc2.lookup_val( 1003, 0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check that we can accumulate the first into the second</span></div>
<div class="line">    conc2.accumulate_concs( conc1 );</div>
<div class="line">    EXPECT_FLOAT_EQ( a, conc2.lookup_val( 1001, 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( b + c, conc2.lookup_val( 1002, 0 ) );</div>
<div class="line">    EXPECT_FLOAT_EQ( c, conc2.lookup_val( 1003, 0 ) );</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
