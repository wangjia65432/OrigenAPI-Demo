<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.10"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>ORIGEN API: tstTransitionSystemAdapter_DecayResource.cpp</title>
        <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="../../dynsections.js"></script>
        <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
        <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
        <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">ORIGEN API v0.5.2</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Overview</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../modules.html"><span>Components</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../d1/d5b/md__c_h_a_n_g_e_l_o_g.html"><span>Changelog</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tstTransitionSystemAdapter_DecayResource.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;Nemesis/gtest/nemesis_gtest.hh&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d5e/_definitions_8h.html">Origen/Core/Definitions.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Origen/Core/TestPaths.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d3/ddd/_fake_factory_8h.html">Origen/Core/dc/FakeFactory.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../db/dfc/_library_8h.html">Origen/Core/dc/Library.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../de/dc1/_library_header_8h.html">Origen/Core/dc/LibraryHeader.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dc/d25/_nuclide_set_8h.html">Origen/Core/dc/NuclideSet.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../df/d07/_transition_coeff_8h.html">Origen/Core/dc/TransitionCoeff.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d5/df4/_transition_structure_8h.html">Origen/Core/dc/TransitionStructure.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d7/dbd/diff_8h.html">Origen/Core/fn/diff.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dc/d56/populate_8h.html">Origen/Core/fn/populate.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d5/d77/print_8h.html">Origen/Core/fn/print.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d9b/_decay_resource_i_o_8h.html">Origen/Core/io/DecayResourceIO.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d4/d11/_library_i_o_8h.html">Origen/Core/io/LibraryIO.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../de/dbf/_decay_resource_8h.html">Origen/Core/re/DecayResource.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../df/d09/default_nuclide_resource_8h.html">Origen/Core/re/defaultNuclideResource.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d7/daf/_transition_system___gen_8h.html">Origen/Core/ts/TransitionSystem_Gen.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d6/daa/_library_builder_8h.html">Origen/Manager/libld/LibraryBuilder.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../df/d53/_transition_system_adapter___decay_resource_8h.html">Origen/Manager/libld/TransitionSystemAdapter_DecayResource.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ScaleUtils/IO/DB.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>TSA_DecayResourceTester : <span class="keyword">public</span> ::testing::Test</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> SetUp()</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Load a DecayResource from a file.</span></div>
<div class="line">        <a name="_a0"></a><a class="code" href="../../d0/d62/class_origen_1_1_decay_resource.html">Origen::DecayResource</a> dr;</div>
<div class="line">        <a name="_a1"></a><a class="code" href="../../dc/d5b/class_origen_1_1_decay_resource_i_o.html">Origen::DecayResourceIO</a> dr_io;</div>
<div class="line">        ScaleUtils::IO::DB opts;</div>
<div class="line">        dr_io.load( dr, Origen::decay_filepath, opts );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create the TransitionSystemAdapter for the decay resource and</span></div>
<div class="line">        <span class="comment">// populate a transition system from it.</span></div>
<div class="line">        <a name="_a2"></a><a class="code" href="../../d5/dab/class_origen_1_1_transition_system_adapter___decay_resource.html">Origen::TransitionSystemAdapter_DecayResource</a> tsa;</div>
<div class="line">        ts = <a name="a3"></a><a class="code" href="../../d5/dc1/namespace_origen.html#a31ef77d85d54134f52b4ddc610534c47">Origen::SP_TransitionSystem</a>( <span class="keyword">new</span> <a name="_a4"></a><a class="code" href="../../d5/d42/class_origen_1_1_transition_system___gen.html">Origen::TransitionSystem_Gen</a>() );</div>
<div class="line">        tsa.<a name="a5"></a><a class="code" href="../../d5/dab/class_origen_1_1_transition_system_adapter___decay_resource.html#ae1cb7a2227f64430533629c91a1a6739">extend</a>( &amp;*ts, <span class="keyword">true</span>, dr );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a31ef77d85d54134f52b4ddc610534c47">Origen::SP_TransitionSystem</a> ts;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">TEST_F( TSA_DecayResourceTester, Single1003 )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// output a nuclide in detail</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> debug = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">if</span>( debug )</div>
<div class="line">    {</div>
<div class="line">        std::ofstream ofs( <span class="stringliteral">&quot;1003.json&quot;</span> );</div>
<div class="line">        ofs &lt;&lt; ts-&gt;nuclide( 1003 )-&gt;to_string();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create a list</span></div>
<div class="line">    std::vector&lt;int&gt; sizzzaaa_list{10001003, 10002003};</div>
<div class="line"></div>
<div class="line">    <span class="comment">// creating decay library from transition system initialized in SetUp</span></div>
<div class="line">    <a name="_a6"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a> lib;</div>
<div class="line">    <a name="_a7"></a><a class="code" href="../../df/d95/class_origen_1_1_library_builder.html">Origen::LibraryBuilder</a> bld;</div>
<div class="line">    bld.<a name="a8"></a><a class="code" href="../../df/d95/class_origen_1_1_library_builder.html#a2dd497b00a1c58db9f9666693fb83b44">create_decay_library</a>( &amp;lib, sizzzaaa_list, <span class="keyword">true</span>, *ts );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check that ids made it to library</span></div>
<div class="line">    EXPECT_EQ( 10001003, lib.<a name="a9"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html#a91acb9d4be4da86e3d90c43ee40249a1">definition</a>().<a name="a10"></a><a class="code" href="../../d9/d4b/class_origen_1_1_library_header.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>().<a name="a11"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#af65c9c915f254006705af86d2d9c8ddd">ids_at</a>( 0 ) );</div>
<div class="line">    EXPECT_EQ( 10002003, lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#a91acb9d4be4da86e3d90c43ee40249a1">definition</a>().<a class="code" href="../../d9/d4b/class_origen_1_1_library_header.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>().<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#af65c9c915f254006705af86d2d9c8ddd">ids_at</a>( 1 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check decay constants</span></div>
<div class="line">    EXPECT_NEAR( 1.7829e-09, lib.<a name="a12"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html#a7c55c01e1e736dd4b2205d593be18786">decay_data</a>().<a name="a13"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#aa60ce09301066a3c124dc5aef66eec8b">decay_constants</a>.at( 0 ), 1e-10 );</div>
<div class="line">    EXPECT_EQ( 0.0, lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#a7c55c01e1e736dd4b2205d593be18786">decay_data</a>().<a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#aa60ce09301066a3c124dc5aef66eec8b">decay_constants</a>.at( 1 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check transition ids</span></div>
<div class="line">    EXPECT_EQ( 1, lib.<a name="a14"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html#ae02084b4dd43bb4cb770de5db375c12f">transition_structure</a>().<a name="a15"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#ab99cb31f0fe803957e7599f2109fe347">transition_ids_size</a>() );</div>
<div class="line">    EXPECT_EQ( -2, lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#ae02084b4dd43bb4cb770de5db375c12f">transition_structure</a>().<a name="a16"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#aff4b457ce8773db4a2dc7ab34327fe2d">transition_ids_at</a>( 0 ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check transition coeff</span></div>
<div class="line">    EXPECT_EQ( 1, lib.<a name="a17"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html#af17c1b438527c73c132f6e2d17a6af05">transition_coeff_size</a>() );</div>
<div class="line">    EXPECT_NEAR(</div>
<div class="line">        1.7829e-09, lib.<a name="a18"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html#abc79568ef9d6c9109fb3d497fee01f18">transition_coeff_at</a>( 0 ).<a name="a19"></a><a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html#a55b09bfad38784c69479fb52da8ec3de">matrix_at</a>( 0 ), 1e-10 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// output library</span></div>
<div class="line">    <span class="keywordflow">if</span>( debug )</div>
<div class="line">    {</div>
<div class="line">        std::ofstream ofs( <span class="stringliteral">&quot;Single1003.txt&quot;</span> );</div>
<div class="line">        ofs &lt;&lt; lib.<a name="a20"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html#aa48c39f92bc04eded742f5310c74aafe">to_string</a>() &lt;&lt; std::endl;</div>
<div class="line">        ScaleUtils::IO::DB opts;</div>
<div class="line">        <a name="a21"></a><a class="code" href="../../d5/dc1/namespace_origen.html#a74f31502109fccedd04286fd61548627">saveLibrary</a>( lib, <span class="stringliteral">&quot;Single1003.f33&quot;</span>, opts );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// TODO : Re-enable test after library updated!</span></div>
<div class="line">TEST_F( TSA_DecayResourceTester, DISABLED_FullCompare )</div>
<div class="line">{</div>
<div class="line">    std::vector&lt;int&gt; sizzzaaa_list =</div>
<div class="line">        <a name="a22"></a><a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#adc94d0b51de13feabfeddb635e8f942b">Origen::FakeFactory::createNuclideIds_scale62</a>();</div>
<div class="line">    EXPECT_EQ( 2240u, sizzzaaa_list.size() );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a> lib;</div>
<div class="line">    <a class="code" href="../../df/d95/class_origen_1_1_library_builder.html">Origen::LibraryBuilder</a> bld;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// creating decay library from transition system initialized in SetUp</span></div>
<div class="line">    bld.<a class="code" href="../../df/d95/class_origen_1_1_library_builder.html#a2dd497b00a1c58db9f9666693fb83b44">create_decay_library</a>( &amp;lib, sizzzaaa_list, <span class="keyword">true</span>, *ts );</div>
<div class="line"></div>
<div class="line">    <a name="_a23"></a><a class="code" href="../../db/d30/class_origen_1_1_library_i_o.html">Origen::LibraryIO</a> lib_io;</div>
<div class="line">    ScaleUtils::IO::DB opts;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a> lib_orig;</div>
<div class="line">    <span class="keywordtype">bool</span> loaded = lib_io.load( lib_orig, Origen::decaylib_filepath, opts );</div>
<div class="line">    EXPECT_TRUE( loaded );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">auto</span> diff = <a name="a24"></a><a class="code" href="../../d5/dc1/namespace_origen.html#a3570cd02afe1fdde75005eef9a7a19c1">diffLibrary</a>( lib_orig, lib );</div>
<div class="line">    EXPECT_FALSE( diff-&gt;have_difference() )</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;    outputting only differing lines to screen...\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;    outputting old/new libraries to lib_orig.f33/lib.f33...\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;    outputting full diff to file lib.diff.txt\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( diff-&gt;have_difference() )</div>
<div class="line">    {</div>
<div class="line">        diff-&gt;to_string( <span class="keyword">true</span> ); <span class="comment">/*diff only*/</span></div>
<div class="line">        std::ofstream ofs( <span class="stringliteral">&quot;lib.diff.txt&quot;</span> );</div>
<div class="line">        ofs &lt;&lt; diff-&gt;to_string();</div>
<div class="line">        lib_io.save( lib_orig, <span class="stringliteral">&quot;lib_orig.f33&quot;</span>, opts );</div>
<div class="line">        lib_io.save( lib, <span class="stringliteral">&quot;lib.f33&quot;</span>, opts );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// This function uses GTEST macros to test various sizes on the library</span></div>
<div class="line"><span class="comment">// for consistency.</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a25"></a><a class="code" href="../../d8/d9b/tst_transition_system_adapter___decay_resource_8cpp.html#ade61ba2d13afa3ce9354aa311ebefc86">gtestLibrarySizes</a>( <span class="keyword">const</span> <a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a>&amp; lib )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// get various components</span></div>
<div class="line">    <span class="keyword">const</span> <a name="_a26"></a><a class="code" href="../../d9/d4b/class_origen_1_1_library_header.html">Origen::LibraryHeader</a>&amp; def = lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#a91acb9d4be4da86e3d90c43ee40249a1">definition</a>();</div>
<div class="line">    <span class="keyword">const</span> <a name="_a27"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">Origen::NuclideSet</a>&amp; nucset = def.<a class="code" href="../../d9/d4b/class_origen_1_1_library_header.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>();</div>
<div class="line">    <span class="keyword">const</span> <a name="_a28"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html">Origen::DecayData</a>&amp; dd = lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#a7c55c01e1e736dd4b2205d593be18786">decay_data</a>();</div>
<div class="line">    <span class="keyword">const</span> <a name="_a29"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html">Origen::TransitionStructure</a>&amp; tstruct = lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#ae02084b4dd43bb4cb770de5db375c12f">transition_structure</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// get reference numbers of stuff</span></div>
<div class="line">    <span class="keywordtype">size_t</span> total = lib.<a name="a30"></a><a class="code" href="../../de/d87/class_origen_1_1_library.html#a9f78d67a34395eea0b650fd5714a89f7">total_nuclides</a>();</div>
<div class="line">    <span class="keywordtype">size_t</span> num_lt = nucset.<a name="a31"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a960a349ec00ef39c91fb68d76863b523">num_in_sublib</a>( <a name="a32"></a><a class="code" href="../../da/d0d/group___cxx_identifiers.html#ga078f384d1ba9fa5cf96b6eda7cfb5d7f">Origen::SUBLIB_1LT</a> );</div>
<div class="line">    <span class="keywordtype">size_t</span> num_ac = nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a960a349ec00ef39c91fb68d76863b523">num_in_sublib</a>( <a name="a33"></a><a class="code" href="../../da/d0d/group___cxx_identifiers.html#gabd3088395c8d6d875d09fe1ef9f1752a">Origen::SUBLIB_2AC</a> );</div>
<div class="line">    <span class="keywordtype">size_t</span> num_fp = nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a960a349ec00ef39c91fb68d76863b523">num_in_sublib</a>( <a name="a34"></a><a class="code" href="../../da/d0d/group___cxx_identifiers.html#ga2bca3e4f4d7ee705a4739c7e496c794b">Origen::SUBLIB_3FP</a> );</div>
<div class="line">    ASSERT_LT( 0, num_lt );</div>
<div class="line">    ASSERT_LT( 0, num_ac );</div>
<div class="line">    ASSERT_LT( 0, num_fp );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// test number of nuclides</span></div>
<div class="line">    EXPECT_EQ( total, nucset.<a name="a35"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a78b8ff5a97ba7b0394796c2bfb34f3ff">ids_size</a>() );</div>
<div class="line">    EXPECT_EQ( total, nucset.<a name="a36"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a9f78d67a34395eea0b650fd5714a89f7">total_nuclides</a>() );</div>
<div class="line">    EXPECT_EQ( total, def.<a name="a37"></a><a class="code" href="../../d9/d4b/class_origen_1_1_library_header.html#a9f78d67a34395eea0b650fd5714a89f7">total_nuclides</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// test numbers in decay data</span></div>
<div class="line">    EXPECT_EQ( total, dd.<a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#aa60ce09301066a3c124dc5aef66eec8b">decay_constants</a>.size() );</div>
<div class="line">    EXPECT_EQ( total, dd.<a name="a38"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#a8af2124dfdc5be17e6159171f5c3318e">recoverable_energy_values</a>.size() );</div>
<div class="line">    EXPECT_EQ( total, dd.<a name="a39"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#a20e19690b5a5d8554ffcdd06e2165354">q_fractions_from_photons</a>.size() );</div>
<div class="line">    EXPECT_EQ( total, dd.<a name="a40"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#aee092acdc05801ba44688204731f6e60">rcg_for_air</a>.size() );</div>
<div class="line">    EXPECT_EQ( total, dd.<a name="a41"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#a6f4208700c8580edfddf80045fee35d3">rcg_for_water</a>.size() );</div>
<div class="line">    EXPECT_EQ( num_lt, dd.<a name="a42"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#ad3cc8c55d529da390fa0ce9d2978f1d9">abund_of_lite_nuclides</a>.size() );</div>
<div class="line">    EXPECT_LE( 0, dd.<a name="a43"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#af4b91a60ef4162a5afb3806b0b69ccc1">fissionable_nuclide_ids</a>.size() );</div>
<div class="line">    EXPECT_EQ( total, dd.<a name="a44"></a><a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#a1a1083188a6a73c54e408d7fe9535a52">masses</a>.size() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// test number of transitions</span></div>
<div class="line">    <span class="keywordtype">size_t</span> non = tstruct.<a name="a45"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#ac77018ddbf19abdfe2e725fa0155dd22">total_transitions</a>();</div>
<div class="line">    EXPECT_EQ( non, tstruct.<a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#ab99cb31f0fe803957e7599f2109fe347">transition_ids_size</a>() );</div>
<div class="line">    EXPECT_EQ( non, tstruct.<a name="a46"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#a46a8f5ebc272d002f4feb1bc048503ce">parent_positions_size</a>() );</div>
<div class="line">    EXPECT_EQ( total, tstruct.<a name="a47"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#ac3292cd2ad7aa3dc9017589774725aa6">num_parents_size</a>() );</div>
<div class="line">    EXPECT_EQ( total, tstruct.<a name="a48"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#a8fbed526f189bdbd5a178072a1f53572">num_decay_parents_size</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">size_t</span> nfluxgrp = 0;</div>
<div class="line">    <span class="keywordflow">if</span>( lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#af17c1b438527c73c132f6e2d17a6af05">transition_coeff_size</a>() &gt; 0 )</div>
<div class="line">    {</div>
<div class="line">        nfluxgrp = lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#abc79568ef9d6c9109fb3d497fee01f18">transition_coeff_at</a>( 0 ).<a name="a49"></a><a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html#aea91315957e61126e4a8a38ff842a0d5">flux_size</a>();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#af17c1b438527c73c132f6e2d17a6af05">transition_coeff_size</a>(); ++i )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a name="_a50"></a><a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html">Origen::TransitionCoeff</a>&amp; tcoeff = lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#abc79568ef9d6c9109fb3d497fee01f18">transition_coeff_at</a>( i );</div>
<div class="line">        EXPECT_EQ( non, tcoeff.<a name="a51"></a><a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html#add7da17e364b3b3e152ce979b829be7e">matrix_size</a>() );</div>
<div class="line">        EXPECT_EQ( total, tcoeff.<a name="a52"></a><a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html#a7ab46bb645dd6a3b0b93905635bfd95e">loss_xs_size</a>() );</div>
<div class="line">        EXPECT_EQ( num_ac, tcoeff.<a name="a53"></a><a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html#a821fb8a37045ae1e77ca35aeba7c83b7">fission_xs_size</a>() );</div>
<div class="line">        EXPECT_EQ( num_ac + num_lt, tcoeff.<a name="a54"></a><a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html#acb827e55a81ddb644b3c1c3bb3ebd4fd">neutron_yields_size</a>() );</div>
<div class="line">        EXPECT_EQ( nfluxgrp, tcoeff.<a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html#aea91315957e61126e4a8a38ff842a0d5">flux_size</a>() );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// This function uses GTEST macros to test that masses are something</span></div>
<div class="line"><span class="comment">// that&#39;s close but not equal to the mass number.</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a55"></a><a class="code" href="../../d8/d9b/tst_transition_system_adapter___decay_resource_8cpp.html#a996bb51d2a070bea8a52ef86ba40f961">gtestLibraryMasses</a>( <span class="keyword">const</span> <a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a>&amp; lib )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// get various components</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="../../d9/d4b/class_origen_1_1_library_header.html">Origen::LibraryHeader</a>&amp; def = lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#a91acb9d4be4da86e3d90c43ee40249a1">definition</a>();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html">Origen::NuclideSet</a>&amp; nucset = def.<a class="code" href="../../d9/d4b/class_origen_1_1_library_header.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html">Origen::DecayData</a>&amp; dd = lib.<a class="code" href="../../de/d87/class_origen_1_1_library.html#a7c55c01e1e736dd4b2205d593be18786">decay_data</a>();</div>
<div class="line"></div>
<div class="line">    EXPECT_EQ( nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a9f78d67a34395eea0b650fd5714a89f7">total_nuclides</a>(), dd.<a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#a1a1083188a6a73c54e408d7fe9535a52">masses</a>.size() );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; dd.<a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#a1a1083188a6a73c54e408d7fe9535a52">masses</a>.size(); ++i )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> izzzaaa = nucset.<a name="a56"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a2db5370aac62e641c5ad90721b774c83">izzzaaa_at</a>( i );</div>
<div class="line">        <span class="keywordtype">int</span> a = nucset.<a name="a57"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a4155f83b79be5bf5d2cd914b7566f54c">a_at</a>( i );</div>
<div class="line">        <span class="keywordtype">double</span> da = std::abs( dd.<a class="code" href="../../db/d2d/class_origen_1_1_decay_data.html#a1a1083188a6a73c54e408d7fe9535a52">masses</a>[i] - a );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// check that it&#39;s not zero UNLESS it&#39;s C-12</span></div>
<div class="line">        <span class="keywordflow">if</span>( izzzaaa != 6012 &amp;&amp; izzzaaa != 1) EXPECT_LT( 1e-5, da ) &lt;&lt; nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a2db5370aac62e641c5ad90721b774c83">izzzaaa_at</a>( i );</div>
<div class="line">        <span class="keywordflow">if</span>( izzzaaa == 6012 &amp;&amp; izzzaaa != 1) EXPECT_GT( 1e-6, da ) &lt;&lt; nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a2db5370aac62e641c5ad90721b774c83">izzzaaa_at</a>( i );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// check that it&#39;s not more than 1</span></div>
<div class="line">        <span class="keywordflow">if</span> (izzzaaa != 1) EXPECT_GT( 1.0, da );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>LibraryBuilderTester : <span class="keyword">public</span> ::testing::Test</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> SetUp()</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// load decay resource</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        ScaleUtils::IO::DB opts;</div>
<div class="line">        std::string decay_resource( Origen::decay_filepath );</div>
<div class="line">        dr = <a name="a58"></a><a class="code" href="../../d5/dc1/namespace_origen.html#a1285171e00b1ef0e70b95d6b1cac74e8">Origen::SP_DecayResource</a>(</div>
<div class="line">            <a name="a59"></a><a class="code" href="../../d5/dc1/namespace_origen.html#a69c63aeb8adfcc16471ba8c7e86a8a7e">Origen::loadDecayResource</a>( decay_resource, opts ) );</div>
<div class="line">        Insist( opts.numError() == 0, <span class="stringliteral">&quot;decay resource had errors&quot;</span> );</div>
<div class="line"></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// load nuclide resource</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        nr = std::make_shared&lt;Origen::NuclideResource&gt;();</div>
<div class="line">        <a name="a60"></a><a class="code" href="../../d5/dc1/namespace_origen.html#adb61847813ab464c57d90bffa87d9fbf">Origen::defaultNuclideResource</a>( &amp;*nr );</div>
<div class="line"></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// set on library builder</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        bld.<a name="a61"></a><a class="code" href="../../df/d95/class_origen_1_1_library_builder.html#affb3bde4d9d33fd62016584418e6db2a">set_decay_resource</a>( dr );</div>
<div class="line">        bld.<a name="a62"></a><a class="code" href="../../df/d95/class_origen_1_1_library_builder.html#ad3eb8f31a888b9aec622a72071e5b438">set_nuclide_resource</a>( nr );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// create a transition system adapter to create a general transition</span></div>
<div class="line">        <span class="comment">// system from this data</span></div>
<div class="line">        <span class="comment">// see TransitionSystem and friends to_string methods</span></div>
<div class="line">        <a class="code" href="../../d5/dab/class_origen_1_1_transition_system_adapter___decay_resource.html">Origen::TransitionSystemAdapter_DecayResource</a> tsa;</div>
<div class="line">        ts = std::make_shared&lt;Origen::TransitionSystem_Gen&gt;();</div>
<div class="line">        tsa.<a class="code" href="../../d5/dab/class_origen_1_1_transition_system_adapter___decay_resource.html#ae1cb7a2227f64430533629c91a1a6739">extend</a>( &amp;*ts, <span class="keyword">true</span>, *dr );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a601a50317e24065ed150e5a3f8c8e5fa">Origen::SP_NuclideResource</a> nr;</div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a1285171e00b1ef0e70b95d6b1cac74e8">Origen::SP_DecayResource</a> dr;</div>
<div class="line">    <a class="code" href="../../d5/dc1/namespace_origen.html#a31ef77d85d54134f52b4ddc610534c47">Origen::SP_TransitionSystem</a> ts;</div>
<div class="line">    <a class="code" href="../../df/d95/class_origen_1_1_library_builder.html">Origen::LibraryBuilder</a> bld;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">TEST_F( LibraryBuilderTester, CreateNewEnd7Dec )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// list of ids</span></div>
<div class="line">    std::vector&lt;int&gt; sizzzaaa_list =</div>
<div class="line">        <a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#adc94d0b51de13feabfeddb635e8f942b">Origen::FakeFactory::createNuclideIds_scale62</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// build an ORIGEN library with the standard set of SCALE 6.2 ids</span></div>
<div class="line">    <a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a> lib;</div>
<div class="line">    bld.<a class="code" href="../../df/d95/class_origen_1_1_library_builder.html#a2dd497b00a1c58db9f9666693fb83b44">create_decay_library</a>( &amp;lib, sizzzaaa_list, <span class="keyword">true</span>, *ts );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check sizes and then write to disk</span></div>
<div class="line">    ScaleUtils::IO::DB opts;</div>
<div class="line">    opts.set( <span class="stringliteral">&quot;fileFormat&quot;</span>, <span class="stringliteral">&quot;s62b&quot;</span> );</div>
<div class="line">    <span class="keywordtype">bool</span> saved = <a class="code" href="../../d5/dc1/namespace_origen.html#a74f31502109fccedd04286fd61548627">saveLibrary</a>( lib, <span class="stringliteral">&quot;end7dec&quot;</span>, opts );</div>
<div class="line">    EXPECT_TRUE( saved );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">TEST_F( LibraryBuilderTester, AddDecayModes )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// show contents</span></div>
<div class="line">    <span class="comment">// look for cs141 modes</span></div>
<div class="line">    <span class="comment">// 1009   551410    cs141 2.790e-02 3.198e+00    0.534   beta-(0) 9.997e-01</span></div>
<div class="line">    <span class="comment">// beta-,neutron(0) 3.500e-04</span></div>
<div class="line">    <span class="comment">// Origen::printDecayTable(*dr,std::cout);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// get decay parent of interest</span></div>
<div class="line">    <span class="comment">// note ids in table are ZZZAAAI!!!</span></div>
<div class="line">    <span class="comment">// internally ORIGEN now uses IZZZAAA</span></div>
<div class="line">    <a name="_a63"></a><a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html">Origen::DecayParent</a>&amp; dp = dr-&gt;get_parent_map()[55141];</div>
<div class="line">    Insist( dp.<a name="a64"></a><a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html#a175a4fa85bf94b567aa767c78f3e5ea1">num_decay_modes</a>() == 2, <span class="stringliteral">&quot;did not find right nuclide&quot;</span> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// get decay channel of interest</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_NONE                = 0;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_GAMMA               = 1;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_BETA_MINUS          = 2;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_BETA_PLUS           = 3;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_ISOMERIC_TRANSITION = 4;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_ALPHA               = 5;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_NEUTRON             = 6;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_SPONTANEOUS_FISSION = 7;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_PROTON              = 8;</span></div>
<div class="line">    <span class="comment">// const int Utils::DECAY_UNKNOWN             = 9;</span></div>
<div class="line"></div>
<div class="line">    <a name="_a65"></a><a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html">Origen::DecayChannel</a>&amp; dc = dp.<a name="a66"></a><a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html#a9a771fbb48ad33f3ca1555f8035294f0">get_channel_map</a>()[26];</div>
<div class="line">    <span class="comment">// std::cout &lt;&lt; &quot;existing 55141[26] branching</span></div>
<div class="line">    <span class="comment">// ratio=&quot;&lt;&lt;dc.get_branch_ratio()&lt;&lt;std::endl;</span></div>
<div class="line">    <span class="keywordtype">double</span> dconst = dp.<a name="a67"></a><a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html#a817b970e5b1d54959d0e87eec7622213">get_decay_constant</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// change branching ratio for beta-,n</span></div>
<div class="line">    <span class="keywordtype">double</span> new_br = 5e-4;  <span class="comment">// would typically read from file</span></div>
<div class="line">    <span class="keywordtype">double</span> delta_br = dc.get_branch_ratio() - new_br;</div>
<div class="line">    dc.set_branch_ratio( new_br );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add new decay modes and set branching ratio for beta-,2n</span></div>
<div class="line">    <a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html">Origen::DecayChannel</a>&amp; dc_2n = dp.<a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html#a9a771fbb48ad33f3ca1555f8035294f0">get_channel_map</a>()[266];  <span class="comment">// creating new</span></div>
<div class="line">    <span class="keywordtype">double</span> new_br_2n = 6e-4;</div>
<div class="line">    delta_br -= new_br_2n;  <span class="comment">// increment delta</span></div>
<div class="line">    dc_2n.<a name="a68"></a><a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html#a44525f0ceb43f4748923c07d568875b8">set_branch_ratio</a>( new_br_2n );</div>
<div class="line">    dc_2n.<a name="a69"></a><a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html#a593a1b004155b1b5c22e849bb2453c07">set_yield_type</a>( <a name="a70"></a><a class="code" href="../../d0/d62/class_origen_1_1_decay_resource.html#a4fd4c904cf4bbba51a518c434ec0880a">Origen::DecayResource::ISOMERIC_YIELDS</a> );</div>
<div class="line">    dc_2n.<a name="a71"></a><a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html#a5c79ed5ca4c70fae4640e927f0762cd3">get_yield_map</a>()[0] = 0.95;  <span class="comment">// 95% to ground</span></div>
<div class="line">    dc_2n.<a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html#a5c79ed5ca4c70fae4640e927f0762cd3">get_yield_map</a>()[1] = 0.05;  <span class="comment">// 5% to first metastable</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// know what I&#39;m dealing with so I will hard-code the renormalization of</span></div>
<div class="line">    <span class="comment">// other branch ratio</span></div>
<div class="line">    <a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html">Origen::DecayChannel</a>&amp; dc_other = dp.<a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html#a9a771fbb48ad33f3ca1555f8035294f0">get_channel_map</a>()[2];</div>
<div class="line">    <span class="keywordtype">double</span> other_br = dc_other.<a name="a72"></a><a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html#a5356f4bf2655c095f2602ba787e946ce">get_branch_ratio</a>() + delta_br;</div>
<div class="line">    dc_other.<a class="code" href="../../dc/da1/class_origen_1_1_decay_channel.html#a44525f0ceb43f4748923c07d568875b8">set_branch_ratio</a>( other_br );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Origen::printDecayTable(*dr,std::cout);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// final result should be:</span></div>
<div class="line">    <span class="comment">// 1009   551410    cs141 2.790e-02 3.198e+00    0.534   beta-(0) 9.989e-01</span></div>
<div class="line">    <span class="comment">// beta-,neutron(0) 5.000e-04  beta-,neutron,neutron(0) 5.700e-04</span></div>
<div class="line">    <span class="comment">// beta-,neutron,neutron(1) 3.000e-05</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// calculate reference values</span></div>
<div class="line">    <span class="keywordtype">double</span> coeff_2 = dconst * dp.<a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html#a9a771fbb48ad33f3ca1555f8035294f0">get_channel_map</a>()[2].get_branch_ratio();</div>
<div class="line">    <span class="keywordtype">double</span> coeff_26 = dconst * dp.<a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html#a9a771fbb48ad33f3ca1555f8035294f0">get_channel_map</a>()[26].get_branch_ratio();</div>
<div class="line">    <span class="keywordtype">double</span> coeff_266 =</div>
<div class="line">        dconst * dp.<a class="code" href="../../df/d71/class_origen_1_1_decay_parent.html#a9a771fbb48ad33f3ca1555f8035294f0">get_channel_map</a>()[266].get_branch_ratio() * 0.95;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create a transition system adapter to create a general transition system</span></div>
<div class="line">    <span class="comment">// from this data</span></div>
<div class="line">    <span class="comment">// see TransitionSystem and friends to_string methods</span></div>
<div class="line">    <a class="code" href="../../d5/dab/class_origen_1_1_transition_system_adapter___decay_resource.html">Origen::TransitionSystemAdapter_DecayResource</a> tsa;</div>
<div class="line">    ts = std::make_shared&lt;Origen::TransitionSystem_Gen&gt;();</div>
<div class="line">    tsa.<a class="code" href="../../d5/dab/class_origen_1_1_transition_system_adapter___decay_resource.html#ae1cb7a2227f64430533629c91a1a6739">extend</a>( &amp;*ts, <span class="keyword">true</span>, *dr );</div>
<div class="line"></div>
<div class="line">    std::vector&lt;int&gt; sizzzaaa_list =</div>
<div class="line">        <a class="code" href="../../da/daf/class_origen_1_1_fake_factory.html#adc94d0b51de13feabfeddb635e8f942b">Origen::FakeFactory::createNuclideIds_scale62</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// build an ORIGEN library with the standard set of SCALE 6.2 ids</span></div>
<div class="line">    <a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a> lib;</div>
<div class="line">    bld.<a class="code" href="../../df/d95/class_origen_1_1_library_builder.html#a2dd497b00a1c58db9f9666693fb83b44">create_decay_library</a>( &amp;lib, sizzzaaa_list, <span class="keyword">true</span>, *ts );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check sizes and then write to disk</span></div>
<div class="line">    {</div>
<div class="line">        SCOPED_TRACE( <span class="stringliteral">&quot;in-memory&quot;</span> );</div>
<div class="line">        <a class="code" href="../../d8/d9b/tst_transition_system_adapter___decay_resource_8cpp.html#ade61ba2d13afa3ce9354aa311ebefc86">gtestLibrarySizes</a>( lib );</div>
<div class="line">        <a class="code" href="../../d8/d9b/tst_transition_system_adapter___decay_resource_8cpp.html#a996bb51d2a070bea8a52ef86ba40f961">gtestLibraryMasses</a>( lib );</div>
<div class="line">        ScaleUtils::IO::DB opts;</div>
<div class="line">        <span class="keywordtype">bool</span> saved = <a class="code" href="../../d5/dc1/namespace_origen.html#a74f31502109fccedd04286fd61548627">saveLibrary</a>(</div>
<div class="line">            lib,</div>
<div class="line">            <span class="stringliteral">&quot;decay.f33&quot;</span>,</div>
<div class="line">            opts );  <span class="comment">// library can be used in a couple calculation now</span></div>
<div class="line">        EXPECT_TRUE( saved );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// read from disk and then check sizes</span></div>
<div class="line">    <a class="code" href="../../de/d87/class_origen_1_1_library.html">Origen::Library</a> lib2;</div>
<div class="line">    {</div>
<div class="line">        ScaleUtils::IO::DB opts;</div>
<div class="line">        <a class="code" href="../../db/d30/class_origen_1_1_library_i_o.html">Origen::LibraryIO</a> io;</div>
<div class="line">        <span class="keywordtype">bool</span> loaded = io.load( lib2, <span class="stringliteral">&quot;decay.f33&quot;</span>, opts );</div>
<div class="line">        EXPECT_TRUE( loaded );</div>
<div class="line">        SCOPED_TRACE( <span class="stringliteral">&quot;on-disk&quot;</span> );</div>
<div class="line">        <a class="code" href="../../d8/d9b/tst_transition_system_adapter___decay_resource_8cpp.html#ade61ba2d13afa3ce9354aa311ebefc86">gtestLibrarySizes</a>( lib2 );</div>
<div class="line">        <a class="code" href="../../d8/d9b/tst_transition_system_adapter___decay_resource_8cpp.html#a996bb51d2a070bea8a52ef86ba40f961">gtestLibraryMasses</a>( lib2 );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// now look through library and see that we have some values that we</span></div>
<div class="line">    <span class="comment">// modified</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; nucset = lib2.<a class="code" href="../../de/d87/class_origen_1_1_library.html#a91acb9d4be4da86e3d90c43ee40249a1">definition</a>().<a class="code" href="../../d9/d4b/class_origen_1_1_library_header.html#a30d45658bf2bd71aa3f45267469d959e">nuclide_set</a>();</div>
<div class="line">        <span class="keywordtype">size_t</span> i_cs141 = nucset.<a name="a73"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#ac22193e4729288518cd7ee18b50d49bd">lookup_index</a>( 30055141 );</div>
<div class="line">        ASSERT_GT( nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a9f78d67a34395eea0b650fd5714a89f7">total_nuclides</a>(), i_cs141 );</div>
<div class="line">        ASSERT_EQ( 55141, nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a2db5370aac62e641c5ad90721b774c83">izzzaaa_at</a>( i_cs141 ) );</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; tids = lib2.<a class="code" href="../../de/d87/class_origen_1_1_library.html#ae02084b4dd43bb4cb770de5db375c12f">transition_structure</a>().<a name="a74"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#a42e46a4906e5f4916a5ad9a675e448ff">transition_ids</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; numdp = lib2.<a class="code" href="../../de/d87/class_origen_1_1_library.html#ae02084b4dd43bb4cb770de5db375c12f">transition_structure</a>().<a name="a75"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#ad2a4261b52966c5915a5ddac54886d04">num_decay_parents</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; ppos = lib2.<a class="code" href="../../de/d87/class_origen_1_1_library.html#ae02084b4dd43bb4cb770de5db375c12f">transition_structure</a>().<a name="a76"></a><a class="code" href="../../d5/d8b/class_origen_1_1_transition_structure.html#a80a17b094e52f4e7a5a11a68e1164b1c">parent_positions</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; tcoeff = lib2.<a class="code" href="../../de/d87/class_origen_1_1_library.html#abc79568ef9d6c9109fb3d497fee01f18">transition_coeff_at</a>( 0 ).<a name="a77"></a><a class="code" href="../../d7/ddf/class_origen_1_1_transition_coeff.html#a22734b922eb5ed212fdf902bceb6281c">matrix</a>();</div>
<div class="line">        <span class="keywordtype">size_t</span> j = 0;</div>
<div class="line">        <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; numdp.size(); ++i )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> k = 0; k &lt; numdp[i]; ++k )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">int</span> tid = tids[j];</div>
<div class="line">                <span class="keywordtype">int</span> nind = ppos[j] - 1;</div>
<div class="line">                <span class="keywordflow">if</span>( nind == (<span class="keywordtype">int</span>)i_cs141 )</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// daughter of cs141: 30056139 by mode=-266 with</span></div>
<div class="line">                    <span class="comment">// coeff=1.59056e-05</span></div>
<div class="line">                    <span class="comment">// daughter of cs141: 30056140 by mode=-26 with</span></div>
<div class="line">                    <span class="comment">// coeff=1.39523e-05</span></div>
<div class="line">                    <span class="comment">// daughter of cs141: 30056141 by mode=-2 with</span></div>
<div class="line">                    <span class="comment">// coeff=0.0278739</span></div>
<div class="line">                    <span class="keywordflow">if</span>( nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a2db5370aac62e641c5ad90721b774c83">izzzaaa_at</a>( i ) == 56139 )</div>
<div class="line">                    {</div>
<div class="line">                        EXPECT_EQ( -266, tid );</div>
<div class="line">                        EXPECT_NEAR( coeff_266, tcoeff[j], 1e-4 * coeff_266 );</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a2db5370aac62e641c5ad90721b774c83">izzzaaa_at</a>( i ) == 56140 )</div>
<div class="line">                    {</div>
<div class="line">                        EXPECT_EQ( -26, tid );</div>
<div class="line">                        EXPECT_NEAR( coeff_26, tcoeff[j], 1e-4 * coeff_26 );</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a2db5370aac62e641c5ad90721b774c83">izzzaaa_at</a>( i ) == 56141 )</div>
<div class="line">                    {</div>
<div class="line">                        EXPECT_EQ( -2, tid );</div>
<div class="line">                        EXPECT_NEAR( coeff_2, tcoeff[j], 1e-4 * coeff_2 );</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nucset.<a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a2db5370aac62e641c5ad90721b774c83">izzzaaa_at</a>(i) == 1)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// -266 and -26 also produce neutrons now, need to check?</span></div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        EXPECT_TRUE( <span class="keyword">false</span> )</div>
<div class="line">                            &lt;&lt; <span class="stringliteral">&quot;daughter of cs141: &quot;</span> &lt;&lt; nucset.<a name="a78"></a><a class="code" href="../../d2/de0/class_origen_1_1_nuclide_set.html#a429c44e53774fd93161e6f30e374df1a">sizzzaaa_at</a>( i )</div>
<div class="line">                            &lt;&lt; <span class="stringliteral">&quot; by mode=&quot;</span> &lt;&lt; tid &lt;&lt; <span class="stringliteral">&quot; with coeff=&quot;</span> &lt;&lt; tcoeff[j]</div>
<div class="line">                            &lt;&lt; <span class="stringliteral">&quot; not expected&quot;</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                ++j;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
